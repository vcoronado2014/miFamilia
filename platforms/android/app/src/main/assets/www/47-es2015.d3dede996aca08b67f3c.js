(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{hnZd:function(e,t,i){"use strict";i.r(t),i.d(t,"RegistroUnoPageModule",(function(){return w}));var o=i("ofXK"),r=i("3Pt+"),n=i("TEn/"),s=i("tyNb"),a=i("kmnG"),c=i("d3UM"),l=i("qFsG"),u=i("bTqV"),d=i("NFeN"),m=i("iadO"),b=i("fXoL");i("8LU1"),i("XNiG"),i("quSY"),i("0EQZ");let h=(()=>{class e{}return e.\u0275mod=b.Ob({type:e}),e.\u0275inj=b.Nb({factory:function(t){return new(t||e)}}),e})();var p=i("+rOU");i("u47x"),i("FtGj"),i("/uUt"),i("JX91"),i("pLZG"),i("IzEk"),i("EY2u"),i("VRyK"),i("R0Ic"),i("R1ws");let g=(()=>{class e{}return e.\u0275mod=b.Ob({type:e}),e.\u0275inj=b.Nb({factory:function(t){return new(t||e)},imports:[[o.c,h,p.e]]}),e})();var f=i("FKr1"),v=i("mrSG"),j=i("wd/R"),R=i("ymXj"),C=i("w9zE"),M=i("skLv"),A=i("70lJ");function U(e,t){1&e&&(b.Vb(0,"mat-error"),b.zc(1,"Run requerido"),b.Ub())}function y(e,t){1&e&&(b.Vb(0,"mat-error"),b.zc(1,"Rut inv\xe1lido"),b.Ub())}function N(e,t){1&e&&(b.Vb(0,"mat-error"),b.zc(1,"Fecha nac requerida"),b.Ub())}const E=function(e,t){return{"ion-no-padding":e,"ion-padding":t}};let V=(()=>{class e{constructor(e,t,i,o,r,n,s,a){this.navCtrl=e,this.utiles=t,this.servicioGeo=i,this.parametros=o,this.loading=r,this.formBuilder=n,this.activatedRoute=s,this.router=a,this.nombre="",this.cargando=!1,this.expEmail=/^[^@\s]+@[^@\s]+\.[^@\s]+$/gm,this.tipoMovimiento="1",this.estaAgregandoFamilia=!1,this.paginaAnterior="inicio",this.muestraMensaje=!1,this.objetoMensaje={irA:"inicio",titulo:"",contenido:""},this.RunValidator=e=>{const t=e.get("run").value;return null!==t&&""!==t&&0==this.utiles.Rut(t)&&this.forma.controls.run.setErrors({runInvalido:!1}),null}}ngOnInit(){j.locale("es"),this.activatedRoute.queryParams.subscribe(e=>{e&&e.estaAgregandoFamilia&&(this.estaAgregandoFamilia=!0),e&&e.nombre&&(this.nombre=e.nombre),e&&e.modulo&&(this.paginaAnterior=e.modulo)}),this.cargarForma()}cargarForma(){this.forma=new r.e({run:new r.c("",[r.q.required]),email:new r.c("",[r.q.required,r.q.pattern(this.expEmail)]),fechaNacimiento:new r.c("",[r.q.required])},{validators:this.RunValidator})}volver(){this.navCtrl.navigateRoot(["pre-registro-uno"],{queryParams:{modulo:"inicio",nombre:this.nombre}})}get f(){return this.forma.controls}verificaRegistroCompleto(){return Object(v.b)(this,void 0,void 0,(function*(){if(this.forma.invalid)return;let e=this.forma.controls.run.value,t=this.utiles.entregaIdDispositivo();j(this.forma.controls.fechaNacimiento.value).format("DD-MM-YYYY"),this.cargando=!0;let i=yield this.loading.create({message:"Verificando...<br>Registro",duration:3e3});yield i.present().then(()=>Object(v.b)(this,void 0,void 0,(function*(){this.utiles.isAppOnDevice()?this.servicioGeo.getRegistroAppNativeRun(e,t).then(e=>{var t=JSON.parse(e.data);this.procesarRespuestaRegistroCompleto(t,i)},e=>{this.utiles.presentToast("Ocurri\xf3 un error de obtenci\xf3n identificador","bottom",4e3),i.dismiss()}):this.servicioGeo.getRegistroAppRun(e,t).subscribe(e=>{this.procesarRespuestaRegistroCompleto(e,i)})})))}))}verificaRegistro(){return Object(v.b)(this,void 0,void 0,(function*(){let e=this.forma.controls.run,t=this.utiles.entregaIdDispositivo();this.cargando=!0;let i=yield this.loading.create({message:"Verificando...<br>Registro",duration:3e3});yield i.present().then(()=>Object(v.b)(this,void 0,void 0,(function*(){this.utiles.isAppOnDevice()?this.servicioGeo.getRegistroAppNativeRun(e.value,t).then(e=>{var t=JSON.parse(e.data);this.procesarRespuestaRegistro(t,i)},e=>{this.utiles.presentToast("Ocurri\xf3 un error de obtenci\xf3n identificador","bottom",4e3),i.dismiss()}):this.servicioGeo.getRegistroAppRun(e.value,t).subscribe(e=>{this.procesarRespuestaRegistro(e,i)})})))}))}abrirLogin(){this.navCtrl.navigateRoot("nuevo-login")}procesarRespuestaRegistroCompleto(e,t){e&&null!=e?null!=e.CorreoElectronico&&""!=e.CorreoElectronico&&null!=e.CorreoElectronico&&null!=e.Password&&""!=e.Password&&null!=e.Password&&null!=e.Run&&""!=e.Run&&null!=e.Run&&null!=e.NombreUsuario&&""!=e.NombreUsuario&&null!=e.NombreUsuario?(this.utiles.presentToast("Usted ya tiene registro","middle",5e3),t.dismiss(),0==this.estaAgregandoFamilia&&this.abrirLogin()):(this.registroIncompleto=e,this.utiles.presentToast("Su registro est\xe1 incompleto","middle",5e3),t.dismiss(),this.irARegistro(this.estaAgregandoFamilia)):(t.dismiss(),this.verficarEnrolamientoRayenCompleto())}procesarRespuestaRegistro(e,t){e&&null!=e?null!=e.CorreoElectronico&&""!=e.CorreoElectronico&&null!=e.CorreoElectronico&&null!=e.Password&&""!=e.Password&&null!=e.Password&&null!=e.Run&&""!=e.Run&&null!=e.Run&&null!=e.NombreUsuario&&""!=e.NombreUsuario&&null!=e.NombreUsuario?(this.utiles.presentToast("Usted ya tiene registro","middle",5e3),t.dismiss(),0==this.estaAgregandoFamilia&&this.abrirLogin()):(this.registroIncompleto=e,this.utiles.presentToast("Su registro est\xe1 incompleto","middle",5e3),t.dismiss(),this.irARegistro(this.estaAgregandoFamilia)):(t.dismiss(),this.verficarEnrolamientoRayen())}irARegistro(e){if(this.registroIncompleto){let t={usuario:null,estaAgregandoFamilia:null};t={usuario:JSON.stringify(this.registroIncompleto),estaAgregandoFamilia:e},this.navCtrl.navigateRoot(["registro-usuario"],{queryParams:t})}}irAClaveUnica(){let e=this.forma.controls.run.value,t=j().format("DD-MM-YYYY HH:mm"),i=this.utiles.encriptar(e+"|"+t+"|"+this.tipoMovimiento);localStorage.setItem("STATE_CLAVE_UNICA",i),this.navCtrl.navigateRoot(["login-clave-unica"],{queryParams:{state:i}})}verficarEnrolamientoRayen(){return Object(v.b)(this,void 0,void 0,(function*(){let e=this.forma.controls.run;this.cargando=!0;let t=yield this.loading.create({message:"Verificando...<br>Registro",duration:3e3});yield t.present().then(()=>Object(v.b)(this,void 0,void 0,(function*(){this.utiles.isAppOnDevice()?this.servicioGeo.verificaEnrolamientoNative(e.value).then(e=>{var i=JSON.parse(e.data);this.procesaRespuestaEnrolamiento(i,t)},e=>{this.utiles.presentToast("Ocurri\xf3 un error de obtenci\xf3n identificador","bottom",4e3),t.dismiss()}):this.servicioGeo.verificaEnrolamiento(e.value).subscribe(e=>{this.procesaRespuestaEnrolamiento(e,t)})})))}))}verficarEnrolamientoRayenCompleto(){return Object(v.b)(this,void 0,void 0,(function*(){let e=this.forma.controls.run.value,t=j(this.forma.controls.fechaNacimiento.value).format("DD-MM-YYYY"),i=this.forma.controls.email.value;this.cargando=!0;let o=yield this.loading.create({message:"Verificando...<br>Registro",duration:3e3});yield o.present().then(()=>Object(v.b)(this,void 0,void 0,(function*(){this.utiles.isAppOnDevice()?this.servicioGeo.verificaEnrolamientoCompletoNative(e,t,i).then(e=>{var t=JSON.parse(e.data);this.procesaRespuestaEnrolamiento(t,o)},e=>{this.utiles.presentToast("Ocurri\xf3 un error de obtenci\xf3n identificador","bottom",4e3),o.dismiss()}):this.servicioGeo.verificaEnrolamientoCompleto(e,t,i).subscribe(e=>{this.procesaRespuestaEnrolamiento(e,o)})})))}))}procesaRespuestaEnrolamiento(e,t){if(0==e.RespuestaBase.CodigoMensaje){let i=e.PreRegistro;t.dismiss(),this.muestraMensaje=!0,this.objetoMensaje.irA="inicio",this.objetoMensaje.titulo="Registro en la app mi familia",this.objetoMensaje.contenido=e.RespuestaBase.Mensaje,localStorage.setItem("PRE-REGISTRO",JSON.stringify(i))}else t.dismiss(),this.parametros.USA_CLAVE_UNICA()?this.irAClaveUnica():(this.muestraMensaje=!0,8==e.RespuestaBase.CodigoMensaje?(this.objetoMensaje.irA=this.paginaAnterior,this.objetoMensaje.titulo="Menor de edad",this.objetoMensaje.contenido="No puedes registrarte ya que eres menor de edad y el registro para esta aplicaci\xf3n es s\xf3lo para mayores."):9==e.RespuestaBase.CodigoMensaje?(this.objetoMensaje.irA=this.paginaAnterior,this.objetoMensaje.titulo="Fecha nacimiento no coincide",this.objetoMensaje.contenido="La fecha de nacimiento ingresada no coincide con nuestros registros, rev\xedsela e int\xe9ntelo nuevamente."):10==e.RespuestaBase.CodigoMensaje?(this.objetoMensaje.irA=this.paginaAnterior,this.objetoMensaje.titulo="Email no coincide",this.objetoMensaje.contenido="El email ingresado no coincide con nuestros registros, rev\xedselo e int\xe9ntelo nuevamente."):11==e.RespuestaBase.CodigoMensaje?(this.objetoMensaje.irA=this.paginaAnterior,this.objetoMensaje.titulo="Sin datos de contacto",this.objetoMensaje.contenido="No cuentas con datos de contacto, te sugerimos actualizarlos en tu centro de salud."):12==e.RespuestaBase.CodigoMensaje?(this.objetoMensaje.irA=this.paginaAnterior,this.objetoMensaje.titulo="Establecimiento sin permisos",this.objetoMensaje.contenido="El establecimiento en el cual te encuentras inscrito no tiene permisos para usar la aplicacion."):1==e.RespuestaBase.CodigoMensaje?(this.objetoMensaje.irA=this.paginaAnterior,this.objetoMensaje.titulo="Run no encontrado",this.objetoMensaje.contenido="Por el momento no cuentas con registros de salud en la Red p\xfablica, el run digitado no ha sido encontrado."):(this.objetoMensaje.irA=this.paginaAnterior,this.objetoMensaje.titulo="Mensaje",this.objetoMensaje.contenido=e.RespuestaBase.Mensaje))}}return e.\u0275fac=function(t){return new(t||e)(b.Qb(n.Z),b.Qb(R.a),b.Qb(C.a),b.Qb(M.a),b.Qb(n.W),b.Qb(r.b),b.Qb(s.a),b.Qb(s.g))},e.\u0275cmp=b.Kb({type:e,selectors:[["app-registro-uno"]],decls:47,vars:20,consts:[[3,"ngClass"],[1,"mt-24",3,"hidden"],["mat-icon-button","","aria-label","Example icon-button with a heart icon",3,"click"],[3,"hidden"],[1,"mt-16"],[1,"texto-1"],["novalidate","",3,"formGroup"],["appearance","outline",2,"width","100%"],["matInput","","placeholder","12535301-1","formControlName","run","name","run","required",""],[4,"ngIf"],["matInput","","formControlName","fechaNacimiento","name","fechaNacimiento","required","",3,"matDatepicker"],["matSuffix","",3,"for"],["datepicker",""],["matInput","","placeholder","ejemplo@gmail.com","formControlName","email","name","email","required",""],[1,"mt-24"],["mat-flat-button","","color","primary",2,"width","90%","margin-left","5%",3,"disabled","click"],[3,"titulo","contenido","irA"]],template:function(e,t){if(1&e&&(b.Vb(0,"ion-content",0),b.Vb(1,"ion-row",1),b.Vb(2,"button",2),b.dc("click",(function(){return t.volver()})),b.Vb(3,"mat-icon"),b.zc(4,"arrow_back_ios"),b.Ub(),b.Ub(),b.Ub(),b.Vb(5,"div",3),b.Vb(6,"ion-row",4),b.Vb(7,"h1"),b.zc(8),b.Ub(),b.Ub(),b.Vb(9,"ion-row"),b.Vb(10,"p",5),b.zc(11,"A continuaci\xf3n procederemos a verificar si ya tienes cuenta activa y existen datos cl\xednicos, para esto necesitamos que ingreses tu RUN, fecha de nacimiento y correo electr\xf3nico, la direcci\xf3n de"),b.Vb(12,"strong"),b.zc(13," correo electr\xf3nico debe ser la registrada al momento de inscribirte en tu Centro de salud."),b.Ub(),b.Rb(14,"br"),b.zc(15," Existe la posibilidad de validar con clave \xfanica, siempre y cuando tu Establecimiento tenga habilitado dicho servicio. "),b.Ub(),b.Ub(),b.Vb(16,"form",6),b.Vb(17,"ion-row",4),b.Vb(18,"mat-form-field",7),b.Vb(19,"mat-label"),b.zc(20,"Run (Sin puntos y con gui\xf3n)"),b.Ub(),b.Rb(21,"input",8),b.yc(22,U,2,0,"mat-error",9),b.yc(23,y,2,0,"mat-error",9),b.Ub(),b.Ub(),b.Vb(24,"ion-row"),b.Vb(25,"mat-form-field",7),b.Vb(26,"mat-label"),b.zc(27,"Seleccione fecha nacimiento"),b.Ub(),b.Rb(28,"input",10),b.Rb(29,"mat-datepicker-toggle",11),b.Rb(30,"mat-datepicker",null,12),b.yc(32,N,2,0,"mat-error",9),b.Ub(),b.Ub(),b.Vb(33,"ion-row"),b.Vb(34,"mat-form-field",7),b.Vb(35,"mat-label"),b.zc(36,"Correo electr\xf3nico"),b.Ub(),b.Rb(37,"input",13),b.Vb(38,"mat-error",3),b.zc(39,"Correo requerido"),b.Ub(),b.Vb(40,"mat-error",3),b.zc(41,"Correo inv\xe1lido"),b.Ub(),b.Ub(),b.Ub(),b.Vb(42,"ion-row",14),b.Vb(43,"button",15),b.dc("click",(function(){return t.verificaRegistroCompleto()})),b.zc(44,"CONTINUAR"),b.Ub(),b.Ub(),b.Ub(),b.Ub(),b.Vb(45,"div",3),b.Rb(46,"app-pagina-mensajes",16),b.Ub(),b.Ub()),2&e){const e=b.qc(31);b.jc("ngClass",b.oc(17,E,t.muestraMensaje,0==t.muestraMensaje)),b.Cb(1),b.jc("hidden",t.muestraMensaje),b.Cb(4),b.jc("hidden",t.muestraMensaje),b.Cb(3),b.Bc("Hola, ",t.nombre,", un gusto en conocerte"),b.Cb(8),b.jc("formGroup",t.forma),b.Cb(6),b.jc("ngIf",t.f.run.errors&&t.f.run.errors.required),b.Cb(1),b.jc("ngIf",t.f.run.errors&&0==t.f.run.errors.runInvalido),b.Cb(5),b.jc("matDatepicker",e),b.Cb(1),b.jc("for",e),b.Cb(3),b.jc("ngIf",t.f.fechaNacimiento.errors&&t.f.fechaNacimiento.errors.required),b.Cb(6),b.jc("hidden",!(t.f.email.errors&&t.f.email.errors.required)),b.Cb(2),b.jc("hidden",!(t.f.email.errors&&t.f.email.errors.pattern)),b.Cb(3),b.jc("disabled",t.forma.invalid),b.Cb(2),b.jc("hidden",!t.muestraMensaje),b.Cb(1),b.jc("titulo",t.objetoMensaje.titulo)("contenido",t.objetoMensaje.contenido)("irA",t.objetoMensaje.irA)}},directives:[n.p,o.i,n.K,u.b,d.a,r.r,r.l,r.f,a.c,a.g,l.b,r.a,r.k,r.d,r.p,o.k,m.b,m.d,a.h,m.a,a.b,A.a],styles:[".mt-16[_ngcontent-%COMP%]{margin-top:16px}.mt-32[_ngcontent-%COMP%]{margin-top:32px}.mt-24[_ngcontent-%COMP%]{margin-top:24px}.mt-80[_ngcontent-%COMP%]{margin-top:5em}.mt-40[_ngcontent-%COMP%]{margin-top:2.5em}.mt-36[_ngcontent-%COMP%]{margin-top:2.25em}.mt-52[_ngcontent-%COMP%]{margin-top:3.25em}.texto-1[_ngcontent-%COMP%]{font-size:1.2em;color:#575657}"]}),e})();var O=i("j1ZV");let w=(()=>{class e{}return e.\u0275mod=b.Ob({type:e}),e.\u0275inj=b.Nb({factory:function(t){return new(t||e)},imports:[[o.c,r.g,r.o,n.U,a.e,c.b,l.c,u.c,d.b,m.c,g,f.h,O.a,s.j.forChild([{path:"",component:V}])]]}),e})()}}]);