(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{"1VCC":function(i,o,e){"use strict";e.d(o,"a",(function(){return s}));var t=e("fXoL"),n=e("TEn/");let s=(()=>{class i{constructor(){this.mostrar=!1}ngOnInit(){}}return i.\u0275fac=function(o){return new(o||i)},i.\u0275cmp=t.Kb({type:i,selectors:[["app-progress"]],inputs:{mostrar:"mostrar",titulo:"titulo"},decls:4,vars:2,consts:[[1,"centrado",3,"hidden"],[1,"titulo-item-2"],["type","indeterminate",1,"ion-margin-top"]],template:function(i,o){1&i&&(t.Vb(0,"div",0),t.Vb(1,"ion-label",1),t.zc(2),t.Ub(),t.Rb(3,"ion-progress-bar",2),t.Ub()),2&i&&(t.jc("hidden",!o.mostrar),t.Cb(2),t.Ac(o.titulo))},directives:[n.A,n.G],styles:[".centrado[_ngcontent-%COMP%]{text-align:center;width:100%;height:10%;position:absolute;top:45%;padding-left:60px;padding-right:60px}.titulo-item-2[_ngcontent-%COMP%]{font-size:16px;color:rgba(0,0,0,.87)}"]}),i})()},PO8b:function(i,o,e){"use strict";e.r(o),e.d(o,"CuposDisponiblesPageModule",(function(){return M}));var t=e("ofXK"),n=e("3Pt+"),s=e("TEn/"),a=e("tyNb"),c=e("mrSG"),r=e("wd/R"),l=e("hxmY"),d=e("fXoL");let b=(()=>{class i{transform(i,o){return i?o?i.filter(i=>Object.keys(i).some(e=>String(i[e]).toLowerCase().includes(o.toLowerCase()))):i:[]}}return i.\u0275fac=function(o){return new(o||i)},i.\u0275pipe=d.Pb({name:"filter",type:i,pure:!0}),i})();var u=e("/Lwr"),h=e("ymXj"),p=e("Li8n"),m=e("MTKf");const g=["myList"];function f(i,o){if(1&i&&(d.Vb(0,"ion-select-option",18),d.zc(1),d.Ub()),2&i){const i=o.$implicit;d.jc("value",i.Texto),d.Cb(1),d.Ac(i.Texto)}}function C(i,o){if(1&i){const i=d.Wb();d.Vb(0,"ion-icon",19),d.dc("click",(function(){return d.rc(i),d.gc().onClickCambiarSemana("ant")})),d.Ub()}}function A(i,o){1&i&&(d.Vb(0,"ion-badge",23),d.Rb(1,"ion-icon",24),d.Ub())}function S(i,o){if(1&i){const i=d.Wb();d.Vb(0,"ion-col",20),d.dc("click",(function(){d.rc(i);const e=o.$implicit;return d.gc().seleccionarCuposAgrupados(e)})),d.Vb(1,"ion-label",21),d.Vb(2,"strong"),d.zc(3),d.Ub(),d.Ub(),d.Vb(4,"p",21),d.zc(5),d.Ub(),d.yc(6,A,2,0,"ion-badge",22),d.Ub()}if(2&i){const i=o.$implicit,e=d.gc();d.xc("background",i.selected?"#3880ff":"#3dc2ff",d.Jb)("color",e.textColor),d.Cb(3),d.Ac(i.diaStr),d.Cb(2),d.Bc(" ",i.texto," "),d.Cb(1),d.jc("ngIf",i.total>0)}}function v(i,o){if(1&i){const i=d.Wb();d.Vb(0,"ion-icon",25),d.dc("click",(function(){return d.rc(i),d.gc().onClickCambiarSemana("sig")})),d.Ub()}}const D=function(i){return{danger:i}},U=function(i,o){return{"danger-boton":i,"success-boton":o}};function V(i,o){if(1&i){const i=d.Wb();d.Vb(0,"div"),d.Vb(1,"ion-item",29),d.Vb(2,"ion-label",30),d.Vb(3,"h5"),d.Rb(4,"ion-icon",31),d.zc(5),d.Ub(),d.Vb(6,"h6"),d.Rb(7,"ion-icon",32),d.zc(8),d.Ub(),d.Vb(9,"h6",33),d.Rb(10,"ion-icon",34),d.zc(11),d.Ub(),d.Vb(12,"h6",33),d.zc(13,"Estado: "),d.Vb(14,"strong"),d.zc(15),d.Ub(),d.Ub(),d.Ub(),d.Vb(16,"ion-button",35),d.dc("click",(function(){d.rc(i);const e=o.$implicit;return d.gc(2).citaSelected(e)})),d.zc(17),d.Rb(18,"ion-icon",36),d.Ub(),d.Ub(),d.Ub()}if(2&i){const i=o.$implicit,e=d.gc(2);d.Cb(1),d.jc("hidden",!i.Visible),d.Cb(1),d.jc("ngClass",d.nc(9,D,"cancelled"===i.Estado)),d.Cb(3),d.Bc("\xa0",i.Servicio.Nombre,""),d.Cb(3),d.Bc("\xa0",i.TipoAtencion,""),d.Cb(3),d.Bc("\xa0",e.transformDate(i.FechaHoraInicio,"dddd DD MMMM YYYY"),""),d.Cb(4),d.Ac(e.traduceString(i.Estado)),d.Cb(1),d.jc("ngClass",d.oc(11,U,"cancelled"===i.Estado,"booked"===i.Estado||"confirmed"===i.Estado)),d.Cb(1),d.Cc("",i.HoraInicio," - ",i.HoraTermino," ")}}function y(i,o){if(1&i&&(d.Vb(0,"ion-list",26),d.Vb(1,"ion-list-header",27),d.Vb(2,"ion-label"),d.Vb(3,"h1"),d.zc(4),d.Ub(),d.Ub(),d.Vb(5,"ion-label"),d.zc(6),d.Ub(),d.Ub(),d.yc(7,V,19,14,"div",28),d.Ub()),2&i){const i=o.$implicit,e=d.gc();d.Cb(1),d.jc("hidden",0==e.contadorHorasDisponibles(i[1].HorasDisponibles)),d.Cb(3),d.Ac(i[1].MedicoPrestador.NombreCompletoMedico),d.Cb(2),d.Ac(i[0]),d.Cb(1),d.jc("ngForOf",i[1].HorasDisponibles)}}function I(i,o){1&i&&(d.Vb(0,"ion-row"),d.Vb(1,"div",37),d.Vb(2,"p",38),d.zc(3,"No hay citas para el d\xeda seleccionado "),d.Rb(4,"br"),d.Rb(5,"ion-icon",39),d.Ub(),d.Ub(),d.Ub())}let T=(()=>{class i{constructor(i,o,e,t,n,s,a,c,r){this.navCtrl=i,this.toast=o,this.modalCtrl=e,this.platform=t,this.loading=n,this.menu=s,this.utiles=a,this.acceso=c,this.cita=r,this.miColor="#FF4081",this.semanas=[],this.textColor="#FFFFFF",this.citas=[],this.citasAgrupadas=[],this.cuposAgrupadosSelected=[],this.runPaciente="",this.codigoDeis="",this.serviceType="349",this.indiceAnterior=0,this.indiceSiguiente=1,this.indiceActual=0,this.anteriorEnabled=!1,this.siguienteEnabled=!0,this.cantidadSemanas=3,this.tipoOperacion="disponibilidad",this.tiposAtencion=[],this.comboSeleccionado=""}ngOnInit(){r.locale("es"),sessionStorage.UsuarioAps&&(this.usuarioAps=JSON.parse(sessionStorage.UsuarioAps),this.usuarioAps&&(this.usuarioAps.UrlImagen=this.utiles.entregaImagen(this.usuarioAps),this.miColor=this.utiles.entregaColor(this.usuarioAps),this.runPaciente=this.utiles.insertarGuion(this.usuarioAps.Rut),this.codigoDeis=this.usuarioAps.ConfiguracionNodo.CodigoDeis2014,this.nodId=this.usuarioAps.ConfiguracionNodo.NodId)),this.construyeSemanaBuscar(0,"sig")}construyeSemanaBuscar(i,o){var e=new Date;if(null==o&&this.semana){var t=r(),n=new Date;"ant"==o?(t=r(this.semana.start).add(-8,"day"),n=new Date(t.year(),t.month(),t.date(),0,0,0,0)):(t=r(this.semana.end),n=new Date(t.year(),t.month(),t.date(),0,0,0,0)),this.utiles.construyeSemana(this.runPaciente,this.codigoDeis,n),this.semana=this.utiles.semana,this.semanas=this.utiles.semanas;var s=this.semana.start,a=this.semana.end;sessionStorage.setItem("PAGINA_ACTUAL",i),this.buscarDisponibilidad(s,a,this.codigoDeis,this.runPaciente,this.serviceType,this.tipoOperacion)}0==i?(this.utiles.construyeSemana(this.runPaciente,this.codigoDeis,e),this.semana=this.utiles.semana,this.semanas=this.utiles.semanas,s=this.semana.start,a=this.semana.end,sessionStorage.setItem("PAGINA_ACTUAL",i),this.buscarDisponibilidad(s,a,this.codigoDeis,this.runPaciente,this.serviceType,this.tipoOperacion)):this.semana&&(t=r(),n=new Date,"ant"==o?(t=r(this.semana.start).add(-8,"day"),n=new Date(t.year(),t.month(),t.date(),0,0,0,0)):(t=r(this.semana.end),n=new Date(t.year(),t.month(),t.date(),0,0,0,0)),this.utiles.construyeSemana(this.runPaciente,this.codigoDeis,n),this.semana=this.utiles.semana,this.semanas=this.utiles.semanas,s=this.semana.start,a=this.semana.end,sessionStorage.setItem("PAGINA_ACTUAL",i),this.buscarDisponibilidad(s,a,this.codigoDeis,this.runPaciente,this.serviceType,this.tipoOperacion))}buscarDisponibilidad(i,o,e,t,n,s){return Object(c.b)(this,void 0,void 0,(function*(){let a=yield this.loading.create({message:"Cargando...<br>disponibilidad",duration:2e4});yield a.present().then(()=>Object(c.b)(this,void 0,void 0,(function*(){this.citas=[],this.citasAgrupadas=[],this.utiles.isAppOnDevice()?this.cita.getDisponibilidadNative(i,o,e,t,n,"","",s,this.nodId).then(i=>{var o=JSON.parse(i.data);this.procesarRespuestaTotal(o,a)}):this.cita.getDisponibilidad(i,o,e,t,n,"","",s,this.nodId).subscribe(i=>{this.procesarRespuestaTotal(i,a)})})))}))}procesarRespuestaTotal(i,o){this.cuposAgrupadosSelected=[],this.tiposAtencion=[],i&&i.Mensaje&&("correcto"==i.Mensaje.Codigo?(i.CitasDisponibles&&i.CitasDisponibles.length>0&&i.CitasDisponibles.forEach(i=>{i.horaInicio=r(i.FechaHoraInicio).format("HH:mm"),i.horaTermino=r(i.FechaHoraTermino).format("HH:mm")}),i.TiposAtencion&&(this.tiposAtencion=this.crearTiposAtencion(i.TiposAtencion),this.tiposAtencion&&this.tiposAtencion.length>0&&(this.comboSeleccionado=this.tiposAtencion[0].Texto)),this.citas=i.CitasDisponibles,this.semana.semanas&&this.semana.semanas.length>0&&this.semana.semanas.forEach(i=>{var o=0;this.citas&&this.citas.length>0&&(i.Cupos=[],this.citas.forEach(e=>{var t=r(e.FechaHoraInicio).format("YYYY-MM-DD");r(i.start).format("YYYY-MM-DD")==t&&(i.Cupos.push(e),o++)})),i.total=o,i.CuposAgrupados=this.agruparCitasTodas(i.Cupos)}),sessionStorage.setItem("CUPOS_SEMANA",JSON.stringify(this.semana)),this.cuposAgrupadosSelected=this.semana.semanas[0].CuposAgrupados,this.filtrarTiposAtencion(),o.dismiss()):(this.cuposAgrupadosSelected=[],o.dismiss()))}agruparCitasTodas(i){let o={};return i&&i.length>0&&i.forEach(i=>{o.hasOwnProperty(i.RunMedico)||(o[i.RunMedico]={MedicoPrestador:{NombreCompletoMedico:i.NombresMedico+" "+i.ApellidosMedico,RunMedico:i.RunMedico},HorasDisponibles:[]}),o[i.RunMedico].HorasDisponibles.push({ApellidosMedico:i.ApellidosMedico,Estado:i.Estado,FechaHoraCreacion:i.FechaHoraCreacion,FechaHoraInicio:i.FechaHoraInicio,FechaHoraTermino:i.FechaHoraTermino,Id:i.Id,IdCita:i.IdCita,IdPaciente:i.IdPaciente,NombresMedico:i.NombresMedico,RunMedico:i.RunMedico,RunPaciente:i.RunPaciente,Servicio:{CodigoDeis:i.Servicio.CodigoDeis,IdServicio:i.Servicio.IdServicio,Nombre:i.Servicio.Nombre,NombreServicio:i.Servicio.NombreServicio},Tipo:i.Tipo,TipoAtencion:i.TipoAtencion,TipoServicio:{Codigo:i.TipoServicio.Codigo,Nombre:i.TipoServicio.Nombre},HoraInicio:this.transformDateIso(new Date(i.FechaHoraInicio).toISOString()),HoraTermino:this.transformDateIso(new Date(i.FechaHoraTermino).toISOString()),Visible:!0})}),Object.entries(o)}crearTiposAtencion(i){var o=[];return i&&i.length>0&&i.forEach(i=>{var e=1;o.push({Texto:i,Valor:e,Selected:!1}),e++}),o}transformDate(i,o){return(new l.a).transform(i,o)}traduceString(i){return this.utiles.traduceString(i)}logout(){this.acceso.logout(),this.navCtrl.navigateRoot("login")}onClickCambiarSemana(i){if("ant"==i){if(0==this.indiceActual)return;this.indiceActual--}else{if(!(this.indiceActual<this.cantidadSemanas))return;this.indiceActual++}this.construyeSemanaBuscar(this.indiceActual,i)}filtrarSemana(i){if(i&&i.Cupos>0){var o=0;i.Cupos.forEach(i=>{i.TipoAtencion==this.comboSeleccionado&&o++}),i.total=o,i.CuposAgrupados&&i.CuposAgrupados.length>0&&i.CuposAgrupados.forEach(i=>{i[1].HorasDisponibles&&i[1].HorasDisponibles.length>0&&i[1].HorasDisponibles.forEach(i=>{i.Visible=i.TipoAtencion==this.comboSeleccionado})})}}seleccionarCuposAgrupados(i){this.itemSelected=i,this.cuposAgrupadosSelected=[],null!=i&&this.semana.semanas&&this.semana.semanas.length>0&&this.semana.semanas.forEach(o=>{o.end==i.end?(o.selected=!0,this.cuposAgrupadosSelected=o.CuposAgrupados,this.filtrarTiposAtencion()):o.selected=!1})}tipoSeleccionado(i){i.detail.value&&(this.comboSeleccionado=i.detail.value,this.filtrarTiposAtencion())}filtrarTiposAtencion(){this.cuposAgrupadosSelected&&this.cuposAgrupadosSelected.length>0&&this.cuposAgrupadosSelected.forEach(i=>{i[1].HorasDisponibles&&i[1].HorasDisponibles.length>0&&i[1].HorasDisponibles.forEach(i=>{i.Visible=i.TipoAtencion==this.comboSeleccionado})}),this.semana&&(this.semana&&this.semana.semanas&&this.semana.semanas.forEach(i=>{var o=0;i.Cupos&&i.Cupos.length>0&&i.Cupos.forEach(i=>{i.TipoAtencion==this.comboSeleccionado&&o++}),i.total=o}),sessionStorage.setItem("CUPOS_SEMANA",JSON.stringify(this.semana)))}contadorHorasDisponibles(i){var o=0;return i&&i.length>0&&i.forEach(i=>{i.TipoAtencion==this.comboSeleccionado&&o++}),o}filter(i){var o=new b,e=[];return i&&i.length>0&&i.forEach(i=>{i[1].HorasDisponibles&&i[1].HorasDisponibles.length>0&&(e=o.transform(i[1].HorasDisponibles,this.comboSeleccionado))}),e}citaSelected(i){return Object(c.b)(this,void 0,void 0,(function*(){i&&(this.itemSelected=i);const o=yield this.modalCtrl.create({component:u.a,componentProps:{cita:JSON.stringify(i),operacion:"reservar"}});return o.onDidDismiss().then(i=>{if(i.data&&i.data.accion){var o=0;sessionStorage.getItem("NUMERO_PAGINA")&&(o=parseInt(sessionStorage.getItem("NUMERO_PAGINA"))),this.construyeSemanaBuscar(o,null)}}),yield o.present()}))}transformDateIso(i){var o="",e=i.split("T");if(e&&2==e.length){var t=e[1].split(":");t&&t.length>1&&(o=t[0]+":"+t[1])}return o}}return i.\u0275fac=function(o){return new(o||i)(d.Qb(s.Z),d.Qb(s.gb),d.Qb(s.Y),d.Qb(s.bb),d.Qb(s.W),d.Qb(s.X),d.Qb(h.a),d.Qb(p.a),d.Qb(m.a))},i.\u0275cmp=d.Kb({type:i,selectors:[["app-cupos-disponibles"]],viewQuery:function(i,o){var e;1&i&&d.Fc(g,!0,s.z),2&i&&d.pc(e=d.ec())&&(o.list=e.first)},decls:31,vars:24,consts:[["mode","md"],["slot","start"],["defaultHref","/home",1,"fcw"],[1,"fcw"],[1,"back-app"],["interface","popover","multiple","false",3,"value","ionChange"],[3,"value",4,"ngFor","ngForOf"],["size","1",1,"ion-no-margin","ion-no-padding"],["name","chevron-back-outline","style","font-size: 2em;padding-top: 10px;",3,"click",4,"ngIf"],[1,"ion-no-margin","ion-no-padding"],[1,"ion-text-wrap","ion-text-center","titulo-semanas"],["class","ion-text-center ion-padding-bottom label-fecha",3,"background","color","click",4,"ngFor","ngForOf"],["name","chevron-forward-outline","style","font-size: 2em;padding-top: 10px;",3,"click",4,"ngIf"],["class","ion-padding-left",4,"ngFor","ngForOf"],[4,"ngIf"],["vertical","bottom","horizontal","end","slot","fixed"],[3,"click"],["name","close"],[3,"value"],["name","chevron-back-outline",2,"font-size","2em","padding-top","10px",3,"click"],[1,"ion-text-center","ion-padding-bottom","label-fecha",3,"click"],[1,"ion-text-center","ion-text-capitalize"],["class","badge-cita","color","success",4,"ngIf"],["color","success",1,"badge-cita"],["name","checkmark"],["name","chevron-forward-outline",2,"font-size","2em","padding-top","10px",3,"click"],[1,"ion-padding-left"],["lines","inset",3,"hidden"],[4,"ngFor","ngForOf"],["lines","none",3,"hidden"],[1,"ion-text-wrap",3,"ngClass"],["name","navigate","slot","start"],["name","bandage","slot","start"],[1,"ion-text-capitalize"],["name","alarm","slot","start"],[3,"ngClass","click"],["name","chevron-forward-outline","slot","end"],[1,"ion-padding",2,"position","absolute","display","table","height","80%","font-size","30px","color","#BDBDBD","text-align","center"],[2,"display","table-cell","vertical-align","middle"],["name","information-circle",2,"font-size","50px"]],template:function(i,o){1&i&&(d.Vb(0,"ion-header"),d.Vb(1,"ion-toolbar",0),d.Vb(2,"ion-buttons",1),d.Rb(3,"ion-back-button",2),d.Ub(),d.Vb(4,"ion-title",3),d.zc(5,"Cupos disponibles"),d.Ub(),d.Ub(),d.Ub(),d.Vb(6,"ion-content",4),d.Vb(7,"ion-item"),d.Vb(8,"ion-label"),d.zc(9,"Tipos de atenci\xf3n"),d.Ub(),d.Vb(10,"ion-select",5),d.dc("ionChange",(function(i){return o.tipoSeleccionado(i)})),d.yc(11,f,2,2,"ion-select-option",6),d.Ub(),d.Ub(),d.Vb(12,"ion-grid"),d.Vb(13,"ion-row"),d.Vb(14,"ion-col",7),d.yc(15,C,1,0,"ion-icon",8),d.Ub(),d.Vb(16,"ion-col",9),d.Vb(17,"ion-item"),d.Vb(18,"ion-label",10),d.zc(19),d.Ub(),d.Ub(),d.Vb(20,"ion-grid",9),d.Vb(21,"ion-row"),d.yc(22,S,7,7,"ion-col",11),d.Ub(),d.Ub(),d.Ub(),d.Vb(23,"ion-col",7),d.yc(24,v,1,0,"ion-icon",12),d.Ub(),d.Ub(),d.Ub(),d.Vb(25,"div"),d.yc(26,y,8,4,"ion-list",13),d.yc(27,I,6,0,"ion-row",14),d.Ub(),d.Ub(),d.Vb(28,"ion-fab",15),d.Vb(29,"ion-fab-button",16),d.dc("click",(function(){return o.logout()})),d.Rb(30,"ion-icon",17),d.Ub(),d.Ub()),2&i&&(d.Cb(1),d.xc("--background",o.miColor),d.Cb(9),d.kc("value",o.comboSeleccionado),d.Cb(1),d.jc("ngForOf",o.tiposAtencion),d.Cb(3),d.xc("background",o.miColor,d.Jb)("color",o.textColor),d.Cb(1),d.jc("ngIf",o.indiceActual>0),d.Cb(2),d.xc("--background",o.miColor)("--color",o.textColor),d.Cb(2),d.Bc(" ",o.semana.texto," "),d.Cb(3),d.jc("ngForOf",o.semana.semanas),d.Cb(1),d.xc("background",o.miColor,d.Jb)("color",o.textColor),d.Cb(1),d.jc("ngIf",o.indiceActual<o.cantidadSemanas),d.Cb(2),d.jc("ngForOf",o.cuposAgrupadosSelected),d.Cb(1),d.jc("ngIf",0==o.cuposAgrupadosSelected.length),d.Cb(2),d.xc("--background",o.miColor))},directives:[s.u,s.T,s.i,s.e,s.f,s.R,s.p,s.z,s.A,s.M,s.eb,t.j,s.t,s.K,s.o,t.k,s.r,s.s,s.v,s.N,s.g,s.B,s.C,t.i,s.h],styles:[".titulo-semanas[_ngcontent-%COMP%]{font-size:.8em}.badge-cita[_ngcontent-%COMP%]{position:absolute;top:2px;right:1px;border-radius:100%}.danger[_ngcontent-%COMP%]{color:var(--ion-color-danger)}.danger-boton[_ngcontent-%COMP%]{--background:var(--ion-color-danger)}.success-boton[_ngcontent-%COMP%]{--background:var(--ion-color-success)}.label-fecha[_ngcontent-%COMP%]{padding-top:28px}"]}),i})(),M=(()=>{class i{}return i.\u0275mod=d.Ob({type:i}),i.\u0275inj=d.Nb({factory:function(o){return new(o||i)},imports:[[t.c,n.g,s.U,a.j.forChild([{path:"",component:T}])]]}),i})()}}]);