(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{"1VCC":function(t,i,s){"use strict";s.d(i,"a",(function(){return o}));var e=s("fXoL"),a=s("TEn/");let o=(()=>{class t{constructor(){this.mostrar=!1}ngOnInit(){}}return t.\u0275fac=function(i){return new(i||t)},t.\u0275cmp=e.Kb({type:t,selectors:[["app-progress"]],inputs:{mostrar:"mostrar",titulo:"titulo"},decls:4,vars:2,consts:[[1,"centrado",3,"hidden"],[1,"titulo-item-2"],["type","indeterminate",1,"ion-margin-top"]],template:function(t,i){1&t&&(e.Vb(0,"div",0),e.Vb(1,"ion-label",1),e.zc(2),e.Ub(),e.Rb(3,"ion-progress-bar",2),e.Ub()),2&t&&(e.jc("hidden",!i.mostrar),e.Cb(2),e.Ac(i.titulo))},directives:[a.A,a.G],styles:[".centrado[_ngcontent-%COMP%]{text-align:center;width:100%;height:10%;position:absolute;top:45%;padding-left:60px;padding-right:60px}.titulo-item-2[_ngcontent-%COMP%]{font-size:16px;color:rgba(0,0,0,.87)}"]}),t})()},zTqs:function(t,i,s){"use strict";s.r(i),s.d(i,"AsociarFamiliaPageModule",(function(){return O}));var e=s("ofXK"),a=s("3Pt+"),o=s("TEn/"),r=s("tyNb"),n=s("mrSG"),l=s("fXoL"),c=s("ymXj"),d=s("w9zE"),u=s("Li8n"),h=s("skLv"),m=s("1VCC"),g=s("bTqV");function p(t,i){if(1&t){const t=l.Wb();l.Vb(0,"div"),l.Vb(1,"ion-item",13),l.Vb(2,"ion-grid"),l.Vb(3,"ion-row"),l.Vb(4,"ion-col",14),l.Vb(5,"h3",15),l.zc(6),l.Ub(),l.Vb(7,"small"),l.zc(8),l.Ub(),l.Ub(),l.Vb(9,"ion-col",16),l.Vb(10,"ion-toggle",17),l.dc("ngModelChange",(function(s){return l.rc(t),i.$implicit.EsAceptado=s})),l.Ub(),l.Ub(),l.Ub(),l.Ub(),l.Ub(),l.Ub()}if(2&t){const t=i.$implicit;l.Cb(6),l.Ac(t.NombreCompleto),l.Cb(2),l.Bc("Run: ",t.Run,""),l.Cb(2),l.jc("checked",t.EsAceptado)("ngModel",t.EsAceptado)}}function b(t,i){if(1&t){const t=l.Wb();l.Vb(0,"div",10),l.yc(1,p,11,4,"div",11),l.Vb(2,"ion-row"),l.Vb(3,"button",12),l.dc("click",(function(){return l.rc(t),l.gc().onSubmit()})),l.zc(4,"GUARDAR"),l.Ub(),l.Ub(),l.Ub()}if(2&t){const t=l.gc();l.Cb(1),l.jc("ngForOf",t.familiaAsociar),l.Cb(2),l.jc("disabled",0==t.familiaAsociar.length)}}let f=(()=>{class t{constructor(t,i,s,e,a,o,r,n,l,c,d,u,h){this.navCtrl=t,this.toast=i,this.modalCtrl=s,this.platform=e,this.menu=a,this.activatedRoute=o,this.router=r,this.utiles=n,this.loading=l,this.servicioGeo=c,this.acceso=d,this.parametrosApp=u,this.alertController=h,this.familiaAsociar=[],this.estaCargando=!1,this.tituloProgress="",this.nombreUsuario="",this.password="",this.usaEnrolamiento=!1}ngOnInit(){if(this.usaEnrolamiento=this.parametrosApp.USA_LOGIN_ENROLAMIENTO(),localStorage.getItem("REGISTRO")){let t=JSON.parse(localStorage.getItem("REGISTRO"));this.usaEnrolamiento&&localStorage.setItem("TIENE_REGISTRO","false"),this.nombreUsuario=t.Run,this.password=t.Password}this.buscar()}buscar(){if(localStorage.getItem("FAMILIA-POR-ACEPTAR")){let i=JSON.parse(localStorage.getItem("FAMILIA-POR-ACEPTAR"));if(i.length>0){for(var t=0;t<i.length;t++)i[t].Run=this.utiles.insertarGuion(i[t].Run),i[t].EsAceptado=1==i[t].Aceptado;this.familiaAsociar=i}}}procesarFamilia(){return Object(n.b)(this,void 0,void 0,(function*(){if(this.familiaAsociar&&this.familiaAsociar.length>0){let t=this.familiaAsociar[0].UspIdTitular.toString(),i=[];for(let e=0;e<this.familiaAsociar.length;e++){const t=this.familiaAsociar[e];t.EsAceptado&&i.push(t.UspId.toString())}i&&0==i.length&&i.push("0"),this.estaCargando=!0,this.tituloProgress="Guardando informaci\xf3n de la familia";let s=yield this.loading.create({cssClass:"loading-vacio",showBackdrop:!1,spinner:null});yield s.present().then(()=>Object(n.b)(this,void 0,void 0,(function*(){this.utiles.isAppOnDevice()?this.servicioGeo.actualizaFamiliaNative(i.toString(),t).then(t=>{JSON.parse(t.data)?(s.dismiss(),this.estaCargando=!1,this.tituloProgress="",this.autentificarse()):(s.dismiss(),this.estaCargando=!1,this.tituloProgress="",this.utiles.presentToast("Ocurri\xf3 un error al asociar familia","bottom",3e3))}).catch(t=>{console.log(t.message),s.dismiss(),this.estaCargando=!1,this.tituloProgress="",this.utiles.presentToast("Ocurri\xf3 un error al asociar familia","bottom",3e3)}):this.servicioGeo.actualizaFamilia(i.toString(),t).subscribe(t=>{t?(s.dismiss(),this.estaCargando=!1,this.tituloProgress="",this.autentificarse()):(s.dismiss(),this.estaCargando=!1,this.tituloProgress="",this.utiles.presentToast("Ocurri\xf3 un error al asociar familia","bottom",3e3))},t=>{console.log(t.message),s.dismiss(),this.estaCargando=!1,this.tituloProgress="",this.utiles.presentToast("Ocurri\xf3 un error al asociar familia","bottom",3e3)})})))}}))}onSubmit(){if(this.familiaAsociar&&this.familiaAsociar.length>0){let t=this.familiaAsociar.length;this.familiaAsociar.filter(t=>1==t.EsAceptado).length<t?this.presentAlertConfirm("Aviso","Hay al menos un miembro de la familia al cual no est\xe1 aceptando. Posteriormente lo puede volver a aceptar en Activar/Desactivar integrantes. \n\xbfEst\xe1 seguro de continuar?."):this.procesarFamilia()}else this.utiles.presentToast("No hay miembros de la familia a asociar","bottom",3e3)}presentAlertConfirm(t,i){return Object(n.b)(this,void 0,void 0,(function*(){const s=yield this.alertController.create({header:t,message:i,buttons:[{text:"No",role:"cancel",cssClass:"danger",handler:t=>{console.log("Confirm Cancel: blah")}},{text:"Si",cssClass:"success",handler:()=>{this.procesarFamilia()}}]});yield s.present()}))}autentificarse(){return Object(n.b)(this,void 0,void 0,(function*(){let t={UserName:this.nombreUsuario,Password:this.password,UsaEnrolamiento:this.usaEnrolamiento,TokenFCM:this.utiles.entregaTokenFCM()};this.estaCargando=!0,this.tituloProgress="Volviendo a autentificar, espere un momento";let i=yield this.loading.create({cssClass:"loading-vacio",showBackdrop:!1,spinner:null});yield i.present().then(()=>Object(n.b)(this,void 0,void 0,(function*(){this.utiles.isAppOnDevice()?this.acceso.loginWebNative(t).then(t=>{this.procesarLogin(JSON.parse(t.data),i)},t=>{console.log(t.message),this.utiles.presentToast("Ocurri\xf3 un error de autentificaci\xf3n","bottom",4e3),this.estaCargando=!1,i.dismiss(),this.tituloProgress=""}):this.acceso.loginWebDirecto(t).subscribe(t=>{this.procesarLogin(t,i)},t=>{console.log(t.message),i.dismiss(),this.estaCargando=!1,this.tituloProgress=""})})))}))}procesarLogin(t,i){var s=t;let e=!1;if(!s.RespuestaBase)return this.loggedIn=!1,this.CodigoMensaje=1e3,this.Mensaje="Error de llamada Http;",this.loggedIn=!0,this.estaCargando=!1,i.dismiss(),void this.utiles.presentToast(this.Mensaje,"middle",4e3);if(0!=s.RespuestaBase.CodigoMensaje)return this.CodigoMensaje=s.RespuestaBase.CodigoMensaje,this.Mensaje=s.RespuestaBase.Mensaje,i.dismiss(),this.estaCargando=!1,void this.utiles.presentToast(this.Mensaje,"middle",4e3);var a;if(s.UsuarioAps)if((a=JSON.stringify(s.UsuarioAps)).NodId&&this.parametrosApp.USA_ENTIDAD_CONTRATANTE()){if(!(s.UsuarioAps.EntidadContratante&&s.UsuarioAps.EntidadContratante.length>0))return this.utiles.presentToast("No tiene entidad contratante asociada","middle",3e3),i.dismiss(),this.estaCargando=!1,void(this.tituloProgress="");e=!0,this.setDatosUsuario(s,a,void 0),i.dismiss(),this.estaCargando=!1,this.tituloProgress=""}else e=!0,this.setDatosUsuario(s,a,void 0),i.dismiss(),this.estaCargando=!1,this.tituloProgress="";e||this.utiles.presentToast("Tiene registro correcto, pero no cuenta con informaci\xf3n en la red de salud.","middle",3e3),this.irAHome()}setDatosUsuario(t,i,s){if(sessionStorage.setItem("UsuarioAps",i),localStorage.setItem("MI_RUT",t.UsuarioAps.Rut),localStorage.setItem("MI_NOMBRE",t.UsuarioAps.Nombres+" "+t.UsuarioAps.ApellidoPaterno),localStorage.setItem("MI_COLOR",t.UsuarioAps.Color),localStorage.setItem("MI_IMAGEN",t.UsuarioAps.UrlImagen),localStorage.setItem("UsuarioAps",i),t.UsuariosFamilia){let i={};var e=t.UsuariosFamilia.filter(t=>!i[t.Id]&&(i[t.Id]=!0));t.UsuariosFamilia=e,s=JSON.stringify(t.UsuariosFamilia),localStorage.setItem("UsuariosFamilia",s)}t.FamiliaPorAceptar&&t.FamiliaPorAceptar.length>=0&&localStorage.setItem("FAMILIA-POR-ACEPTAR",JSON.stringify(t.FamiliaPorAceptar)),t.FamiliaAceptada&&t.FamiliaAceptada.length>=0&&localStorage.setItem("FAMILIA-ACEPTADA",JSON.stringify(t.FamiliaAceptada)),t.FamiliaRechazada&&t.FamiliaRechazada.length>=0&&localStorage.setItem("FAMILIA-RECHAZADA",JSON.stringify(t.FamiliaRechazada)),this.CodigoMensaje=t.RespuestaBase.CodigoMensaje,this.Mensaje=t.RespuestaBase.Mensaje,this.loggedIn=!0}irAHome(){this.navCtrl.navigateRoot("home")}}return t.\u0275fac=function(i){return new(i||t)(l.Qb(o.Z),l.Qb(o.gb),l.Qb(o.Y),l.Qb(o.bb),l.Qb(o.X),l.Qb(r.a),l.Qb(r.g),l.Qb(c.a),l.Qb(o.W),l.Qb(d.a),l.Qb(u.a),l.Qb(h.a),l.Qb(o.a))},t.\u0275cmp=l.Kb({type:t,selectors:[["app-asociar-familia"]],decls:14,vars:4,consts:[[1,"back-app"],["color","primary","mode","md"],["slot","start"],["defaultHref","/home",1,"fcw"],[1,"fcw"],[3,"mostrar","titulo"],[3,"hidden"],[1,"ion-padding"],[1,"texto-item"],["style","padding-top: 16px;",4,"ngIf"],[2,"padding-top","16px"],[4,"ngFor","ngForOf"],["mat-raised-button","","color","accent",1,"button-registrarse",3,"disabled","click"],["lines","inset"],["size","10"],[1,"text-avatar"],["size","2"],["mode","ios",3,"checked","ngModel","ngModelChange"]],template:function(t,i){1&t&&(l.Vb(0,"ion-header",0),l.Vb(1,"ion-toolbar",1),l.Vb(2,"ion-buttons",2),l.Rb(3,"ion-back-button",3),l.Ub(),l.Vb(4,"ion-title",4),l.zc(5,"Asociar familia"),l.Ub(),l.Ub(),l.Ub(),l.Vb(6,"ion-content",0),l.Rb(7,"app-progress",5),l.Vb(8,"div",6),l.Vb(9,"div",7),l.Vb(10,"p",8),l.zc(11," Puede asociar a los miembros de la familia propuestos deslizando el check de cada unos de ellos."),l.Rb(12,"br"),l.Ub(),l.Ub(),l.yc(13,b,5,2,"div",9),l.Ub(),l.Ub()),2&t&&(l.Cb(7),l.jc("mostrar",i.estaCargando)("titulo",i.tituloProgress),l.Cb(1),l.jc("hidden",i.estaCargando),l.Cb(5),l.jc("ngIf",i.familiaAsociar.length>0))},directives:[o.u,o.T,o.i,o.e,o.f,o.R,o.p,m.a,e.k,e.j,o.K,g.b,o.z,o.t,o.o,o.S,o.b,a.k,a.n],styles:[".button-registrarse[_ngcontent-%COMP%]{margin-top:32px;width:90%;margin-left:5%}"]}),t})();var A=s("j1ZV"),C=s("kmnG"),U=s("d3UM"),v=s("qFsG"),I=s("NFeN");let O=(()=>{class t{}return t.\u0275mod=l.Ob({type:t}),t.\u0275inj=l.Nb({factory:function(i){return new(i||t)},imports:[[e.c,a.g,C.e,U.b,v.c,g.c,I.b,o.U,A.a,r.j.forChild([{path:"",component:f}])]]}),t})()}}]);