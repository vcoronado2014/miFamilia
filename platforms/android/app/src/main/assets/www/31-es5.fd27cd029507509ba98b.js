function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{"1VCC":function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var i=a("fXoL"),n=a("TEn/"),r=function(){var e=function(){function e(){_classCallCheck(this,e),this.mostrar=!1}return _createClass(e,[{key:"ngOnInit",value:function(){}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=i.Kb({type:e,selectors:[["app-progress"]],inputs:{mostrar:"mostrar",titulo:"titulo"},decls:4,vars:2,consts:[[1,"centrado",3,"hidden"],[1,"titulo-item-2"],["type","indeterminate",1,"ion-margin-top"]],template:function(e,t){1&e&&(i.Vb(0,"div",0),i.Vb(1,"ion-label",1),i.zc(2),i.Ub(),i.Rb(3,"ion-progress-bar",2),i.Ub()),2&e&&(i.jc("hidden",!t.mostrar),i.Cb(2),i.Ac(t.titulo))},directives:[n.A,n.G],styles:[".centrado[_ngcontent-%COMP%]{text-align:center;width:100%;height:10%;position:absolute;top:45%;padding-left:60px;padding-right:60px}.titulo-item-2[_ngcontent-%COMP%]{font-size:16px;color:rgba(0,0,0,.87)}"]}),e}()},qi4r:function(e,t,a){"use strict";a.r(t),a.d(t,"NuevoLoginPageModule",(function(){return x}));var i,n,r=a("ofXK"),o=a("3Pt+"),s=a("TEn/"),c=a("tyNb"),l=a("mrSG"),u=a("wd/R"),d=a("fXoL"),m=a("ymXj"),p=a("w9zE"),g=a("Li8n"),h=a("skLv"),f=a("uHM+"),b=a("uJRU"),v=a("xS7M"),C=a("49Bu"),I=a("1VCC"),R=a("kmnG"),S=a("qFsG"),k=a("bTqV"),A=((i=function(){function e(t,a,i,n,r,o,s,c,l,u,d,m,p,g){_classCallCheck(this,e),this.navCtrl=t,this.utiles=a,this.servicioGeo=i,this.loading=n,this.formBuilder=r,this.activatedRoute=o,this.router=s,this.acceso=c,this.parametrosApp=l,this.fcmService=u,this.appVersion=d,this.platform=m,this.device=p,this.servNotificaciones=g,this.hide=!0,this.patternOnlyLetter="[a-zA-Z\xc0-\xff\xf1\xd1]+(s*[a-zA-Z\xc0-\xff\xf1\xd1]*)*[a-zA-Z\xc0-\xff\xf1\xd1 ]+$",this.expCelular=/^(\+?56)?(\s?)(0?9)(\s?)[9876543]\d{7}$/gm,this.expPassword=/^(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{4,8}$/gm,this.expEmail=/^[^@\s]+@[^@\s]+\.[^@\s]+$/gm,this.usaEnrolamiento=!1,this.objetoEntrada={VersionAppName:"",Plataforma:"",Token:"",VersionAppNumber:"",Fecha:new Date,TipoOperacion:"0",Id:"0"},this.estaCargando=!1}return _createClass(e,[{key:"ngOnInit",value:function(){u.locale("es"),this.servNotificaciones.buscarCitasTodas(),this.usaEnrolamiento=this.parametrosApp.USA_LOGIN_ENROLAMIENTO(),this.cargarForma()}},{key:"abrirAsistente",value:function(){this.navCtrl.navigateRoot(["pre-registro-uno"],{queryParams:{modulo:"nuevo-login"}})}},{key:"cargarForma",value:function(){this.forma=new o.e({run:new o.c("",[o.q.required]),email:new o.c("",[o.q.required,o.q.pattern(this.expEmail)]),clave:new o.c("",[o.q.required,o.q.minLength(3),o.q.maxLength(10)])}),this.usaEnrolamiento?this.forma.get("email").clearValidators():this.forma.get("run").clearValidators()}},{key:"crearToken",value:function(){return Object(l.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,a,i,n,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.estaCargando=!0,e.next=3,this.loading.create({cssClass:"loading-vacio",showBackdrop:!1,spinner:null});case 3:return n=e.sent,e.next=6,n.present().then((function(){return Object(l.b)(r,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.utiles.isAppOnDevice()){e.next=31;break}if(!this.platform.is("ios")){e.next=11;break}return e.next=4,this.appVersion.getAppName();case 4:return t=e.sent,e.next=7,this.appVersion.getVersionNumber();case 7:a=e.sent,i="iOS",e.next=22;break;case 11:if(!this.platform.is("android")){e.next=21;break}return e.next=14,this.appVersion.getAppName();case 14:return t=e.sent,e.next=17,this.appVersion.getVersionNumber();case 17:a=e.sent,i="Android",e.next=22;break;case 21:this.platform.is("mobileweb")?(t="Mi salud familiar",a="0.0",i="Web"):(t="Mi salud familiar",a="0.0",i="No informado");case 22:this.tokenDispositivo=this.device.uuid,localStorage.setItem("token_dispositivo",this.tokenDispositivo),localStorage.setItem("version_app_name",t),localStorage.setItem("version_number",a),localStorage.setItem("plataforma",i),n.dismiss(),this.estaCargando=!1,e.next=32;break;case 31:localStorage.getItem("token_dispositivo")?this.tokenDispositivo=localStorage.getItem("token_dispositivo"):(this.tokenDispositivo=(999999*Math.random()+1).toString()+" web",localStorage.setItem("token_dispositivo",this.tokenDispositivo)),t="Mi salud familiar",a="0.0",i="Web",localStorage.setItem("version_app_name",t),localStorage.setItem("version_number",a),localStorage.setItem("plataforma",i),n.dismiss(),this.estaCargando=!1;case 32:case"end":return e.stop()}}),e,this)})))}));case 6:case"end":return e.stop()}}),e,this)})))}},{key:"registrarEntrada",value:function(){return Object(l.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,a=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(sessionStorage.getItem("RSS_ID")){e.next=7;break}return this.objetoEntrada.VersionAppName=localStorage.getItem("version_app_name"),this.objetoEntrada.Plataforma=localStorage.getItem("plataforma"),this.objetoEntrada.VersionAppNumber=localStorage.getItem("version_number"),this.objetoEntrada.Token=localStorage.getItem("token_dispositivo"),this.objetoEntrada.Fecha=new Date,sessionStorage.setItem("ENTRADA",JSON.stringify(this.objetoEntrada)),this.estaCargando=!0,e.next=4,this.loading.create({cssClass:"loading-vacio",showBackdrop:!1,spinner:null});case 4:return t=e.sent,e.next=7,t.present().then((function(){return Object(l.b)(a,void 0,void 0,regeneratorRuntime.mark((function e(){var a=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.utiles.isAppOnDevice()?this.servicioGeo.postIngresoNative(this.objetoEntrada).then((function(e){var i=JSON.parse(e.data);sessionStorage.setItem("RSS_ID",i.Id),t.dismiss(),a.estaCargando=!1})):this.servicioGeo.postIngreso(this.objetoEntrada).subscribe((function(e){e&&e.Id>0&&sessionStorage.setItem("RSS_ID",e.Id),t.dismiss(),a.estaCargando=!1}));case 1:case"end":return e.stop()}}),e,this)})))}));case 7:case"end":return e.stop()}}),e,this)})))}},{key:"loguearseRegistro",value:function(){return Object(l.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,a,i,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.forma.controls.email.value,a=this.forma.controls.clave?this.utiles.encriptar(this.forma.controls.clave.value):"",this.estaCargando=!0,e.next=4,this.loading.create({cssClass:"loading-vacio",showBackdrop:!1,spinner:null});case 4:return i=e.sent,e.next=7,i.present().then((function(){return Object(l.b)(n,void 0,void 0,regeneratorRuntime.mark((function e(){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.utiles.isAppOnDevice()?this.servicioGeo.getRegistroAppNativeCorreoPassword(t,a).then((function(e){var t=JSON.parse(e.data);if(!t)return n.utiles.presentToast("No se encontr\xf3 registro de usuario.","middle",3e3),n.estaCargando=!1,void i.dismiss();localStorage.setItem("REGISTRO",JSON.stringify(t)),localStorage.setItem("TIENE_REGISTRO","true"),i.dismiss();var r=JSON.parse(localStorage.getItem("REGISTRO"));n.autentificarse(r.Run,a)})).catch((function(e){console.log(e.message),n.utiles.presentToast("Error de conexi\xf3n.","middle",3e3),n.estaCargando=!1,i.dismiss()})):this.servicioGeo.getRegistroAppCorreoPassword(t,a).subscribe((function(e){if(!e)return n.utiles.presentToast("No se encontr\xf3 registro de usuario.","middle",3e3),n.estaCargando=!1,void i.dismiss();localStorage.setItem("REGISTRO",JSON.stringify(e)),localStorage.setItem("TIENE_REGISTRO","true"),i.dismiss();var t=JSON.parse(localStorage.getItem("REGISTRO"));n.autentificarse(t.Run,a)}),(function(e){console.log(e.message),n.utiles.presentToast("Error de conexi\xf3n.","middle",3e3),n.estaCargando=!1,i.dismiss()}));case 1:case"end":return e.stop()}}),e,this)})))}));case 7:case"end":return e.stop()}}),e,this)})))}},{key:"loguearseEnrolamiento",value:function(){return Object(l.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.estaCargando=!0,t=this.forma.controls.run.value,a=this.forma.controls.clave?this.utiles.encriptar(this.forma.controls.clave.value):"",localStorage.setItem("TIENE_REGISTRO","false"),this.autentificarse(t,a);case 3:case"end":return e.stop()}}),e,this)})))}},{key:"onSubmit",value:function(){return Object(l.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.forma.invalid||(this.usaEnrolamiento?this.loguearseEnrolamiento():this.loguearseRegistro());case 1:case"end":return e.stop()}}),e,this)})))}},{key:"autentificarse",value:function(e,t){return Object(l.b)(this,void 0,void 0,regeneratorRuntime.mark((function a(){var i,n,r=this;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return i={UserName:e,Password:t,UsaEnrolamiento:this.usaEnrolamiento,TokenFCM:this.utiles.entregaTokenFCM()},this.estaCargando=!0,a.next=4,this.loading.create({cssClass:"loading-vacio",showBackdrop:!1,spinner:null});case 4:return n=a.sent,a.next=7,n.present().then((function(){return Object(l.b)(r,void 0,void 0,regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.utiles.isAppOnDevice()?this.acceso.loginWebNative(i).then((function(e){t.procesarLogin(JSON.parse(e.data),n)}),(function(e){t.utiles.presentToast("Ocurri\xf3 un error de autentificaci\xf3n","bottom",4e3),t.estaCargando=!1,n.dismiss()})):this.acceso.loginWebDirecto(i).subscribe((function(e){t.procesarLogin(e,n)}),(function(e){n.dismiss(),t.estaCargando=!1}));case 1:case"end":return e.stop()}}),e,this)})))}));case 7:case"end":return a.stop()}}),a,this)})))}},{key:"setDatosUsuario",value:function(e,t,a){if(sessionStorage.setItem("UsuarioAps",t),localStorage.setItem("MI_RUT",e.UsuarioAps.Rut),localStorage.setItem("MI_NOMBRE",e.UsuarioAps.Nombres+" "+e.UsuarioAps.ApellidoPaterno),localStorage.setItem("MI_COLOR",e.UsuarioAps.Color),localStorage.setItem("MI_IMAGEN",e.UsuarioAps.UrlImagen),localStorage.setItem("UsuarioAps",t),e.UsuariosFamilia){var i={},n=e.UsuariosFamilia.filter((function(e){return!i[e.Id]&&(i[e.Id]=!0)}));e.UsuariosFamilia=n,a=JSON.stringify(e.UsuariosFamilia),localStorage.setItem("UsuariosFamilia",a)}e.FamiliaPorAceptar&&e.FamiliaPorAceptar.length>=0&&localStorage.setItem("FAMILIA-POR-ACEPTAR",JSON.stringify(e.FamiliaPorAceptar)),e.FamiliaAceptada&&e.FamiliaAceptada.length>=0&&localStorage.setItem("FAMILIA-ACEPTADA",JSON.stringify(e.FamiliaAceptada)),e.FamiliaRechazada&&e.FamiliaRechazada.length>=0&&localStorage.setItem("FAMILIA-RECHAZADA",JSON.stringify(e.FamiliaRechazada)),this.CodigoMensaje=e.RespuestaBase.CodigoMensaje,this.Mensaje=e.RespuestaBase.Mensaje,this.loggedIn=!0}},{key:"procesarLogin",value:function(e,t){var a,i=e,n=!1;if(!i.RespuestaBase)return this.loggedIn=!1,this.CodigoMensaje=1e3,this.Mensaje="Error de llamada Http;",this.loggedIn=!0,this.estaCargando=!1,t.dismiss(),void this.utiles.presentToast(this.Mensaje,"middle",4e3);if(0!=i.RespuestaBase.CodigoMensaje)return this.loggedIn=!1,this.CodigoMensaje=i.RespuestaBase.CodigoMensaje,this.Mensaje=i.RespuestaBase.Mensaje,this.loggedIn=!0,t.dismiss(),this.estaCargando=!1,void this.utiles.presentToast(this.Mensaje,"middle",4e3);if(i.UsuarioAps)if((a=JSON.stringify(i.UsuarioAps)).NodId&&this.parametrosApp.USA_ENTIDAD_CONTRATANTE()){if(!(i.UsuarioAps.EntidadContratante&&i.UsuarioAps.EntidadContratante.length>0))return this.utiles.presentToast("No tiene entidad contratante asociada","middle",3e3),t.dismiss(),void(this.estaCargando=!1);n=!0,this.setDatosUsuario(i,a,void 0),t.dismiss(),this.estaCargando=!1}else n=!0,this.setDatosUsuario(i,a,void 0),t.dismiss(),this.estaCargando=!1;n||this.utiles.presentToast("Tiene registro correcto, pero no cuenta con informaci\xf3n en la red de salud.","middle",3e3),this.crearToken(),this.registrarEntrada(),this.irAHome()}},{key:"irAHome",value:function(){this.navCtrl.navigateRoot("home")}},{key:"irRecuperarClave",value:function(){this.navCtrl.navigateRoot("recuperar-clave")}},{key:"f",get:function(){return this.forma.controls}}]),e}()).\u0275fac=function(e){return new(e||i)(d.Qb(s.Z),d.Qb(m.a),d.Qb(p.a),d.Qb(s.W),d.Qb(o.b),d.Qb(c.a),d.Qb(c.g),d.Qb(g.a),d.Qb(h.a),d.Qb(f.a),d.Qb(b.a),d.Qb(s.bb),d.Qb(v.a),d.Qb(C.a))},i.\u0275cmp=d.Kb({type:i,selectors:[["app-nuevo-login"]],decls:37,vars:12,consts:[[1,"ion-padding"],["titulo","Estamos ingresando a la app",3,"mostrar"],[1,"row","mt-24",3,"hidden"],["src","../../assets/imgs_svg/login.svg","alt","asistente"],["novalidate","",3,"hidden","formGroup"],[1,"ion-no-margin","ion-no-padding","mt-80"],["appearance","outline",2,"width","100%",3,"hidden"],["matInput","","placeholder","125458524","formControlName","run","name","run"],[3,"hidden"],["matInput","","placeholder","ejemplo@gmail.com","formControlName","email","name","email"],["appearance","outline",2,"width","100%"],["matInput","","placeholder","Clave","type","password","name","clave","formControlName","clave","required",""],[1,"ion-no-padding","ion-no-margin","mt-40"],["mat-raised-button","","color","primary",1,"boton-Principal",2,"width","90%","margin-left","5%","height","36px",3,"click"],[1,"mt-36",3,"hidden"],["mat-button","","routerLink",".","color","primary",1,"ion-text-center","accent-color",2,"width","100%",3,"click"],[1,"ion-no-padding","mt-36",3,"hidden"],[1,"ion-text-center","texto-1",2,"margin-top","8px"],["mat-button","","color","primary",1,"accent-color",3,"click"]],template:function(e,t){1&e&&(d.Vb(0,"ion-content",0),d.Rb(1,"app-progress",1),d.Vb(2,"div",2),d.Rb(3,"img",3),d.Ub(),d.Vb(4,"form",4),d.Vb(5,"ion-row",5),d.Vb(6,"mat-form-field",6),d.Vb(7,"mat-label"),d.zc(8,"RUN"),d.Ub(),d.Rb(9,"input",7),d.Vb(10,"mat-error",8),d.zc(11,"Run requerido"),d.Ub(),d.Ub(),d.Vb(12,"mat-form-field",6),d.Vb(13,"mat-label"),d.zc(14,"Correo electr\xf3nico"),d.Ub(),d.Rb(15,"input",9),d.Vb(16,"mat-error",8),d.zc(17,"Correo inv\xe1lido"),d.Ub(),d.Ub(),d.Vb(18,"mat-form-field",10),d.Vb(19,"mat-label"),d.zc(20,"Contrase\xf1a"),d.Ub(),d.Rb(21,"input",11),d.Vb(22,"mat-error",8),d.zc(23,"Clave requerida"),d.Ub(),d.Ub(),d.Ub(),d.Vb(24,"ion-row",12),d.Vb(25,"button",13),d.dc("click",(function(){return t.onSubmit()})),d.zc(26,"INICIAR SESION"),d.Ub(),d.Ub(),d.Ub(),d.Vb(27,"ion-row",14),d.Vb(28,"a",15),d.dc("click",(function(){return t.irRecuperarClave()})),d.zc(29,"\xbfOlvidaste tu contrase\xf1a?"),d.Ub(),d.Ub(),d.Vb(30,"ion-grid",16),d.Vb(31,"ion-row"),d.Vb(32,"ion-col",17),d.zc(33," \xbfNo tienes cuenta? "),d.Ub(),d.Vb(34,"ion-col"),d.Vb(35,"button",18),d.dc("click",(function(){return t.abrirAsistente()})),d.zc(36,"REGISTRATE"),d.Ub(),d.Ub(),d.Ub(),d.Ub(),d.Ub()),2&e&&(d.Cb(1),d.jc("mostrar",t.estaCargando),d.Cb(1),d.jc("hidden",t.estaCargando),d.Cb(2),d.jc("hidden",t.estaCargando)("formGroup",t.forma),d.Cb(2),d.jc("hidden",0==t.usaEnrolamiento),d.Cb(4),d.jc("hidden",0==t.usaEnrolamiento),d.Cb(2),d.jc("hidden",t.usaEnrolamiento),d.Cb(4),d.jc("hidden",t.usaEnrolamiento),d.Cb(6),d.jc("hidden",!(t.f.clave.errors&&t.f.clave.errors.required)),d.Cb(5),d.jc("hidden",t.estaCargando)("hidden",t.usaEnrolamiento),d.Cb(3),d.jc("hidden",t.estaCargando))},directives:[s.p,I.a,o.r,o.l,o.f,s.K,R.c,R.g,S.b,o.a,o.k,o.d,R.b,o.p,k.b,k.a,c.i,s.db,s.t,s.o],styles:[".mt-32[_ngcontent-%COMP%]{margin-top:32px}.mt-24[_ngcontent-%COMP%]{margin-top:24px}.mt-80[_ngcontent-%COMP%]{margin-top:5em}.mt-40[_ngcontent-%COMP%]{margin-top:2.5em}.mt-36[_ngcontent-%COMP%]{margin-top:2.25em}.texto-1[_ngcontent-%COMP%]{font-size:.875em;color:rgba(0,0,0,.54)}.example-container[_ngcontent-%COMP%]   .mat-form-field[_ngcontent-%COMP%] + .mat-form-field[_ngcontent-%COMP%]{margin-left:8px}.example-right-align[_ngcontent-%COMP%]{text-align:right}input.example-right-align[_ngcontent-%COMP%]::-webkit-inner-spin-button, input.example-right-align[_ngcontent-%COMP%]::-webkit-outer-spin-button{display:none}input.example-right-align[_ngcontent-%COMP%]{-moz-appearance:textfield}.accent-color[_ngcontent-%COMP%]{color:#ff4081}.boton-Principal[_ngcontent-%COMP%]{background-color:#ff4081;color:#fff}"]}),i),O=a("d3UM"),w=a("NFeN"),E=a("j1ZV"),x=((n=function e(){_classCallCheck(this,e)}).\u0275mod=d.Ob({type:n}),n.\u0275inj=d.Nb({factory:function(e){return new(e||n)},imports:[[r.c,o.g,o.o,s.U,R.e,O.b,S.c,k.c,w.b,E.a,c.j.forChild([{path:"",component:A}])]]}),n)}}]);