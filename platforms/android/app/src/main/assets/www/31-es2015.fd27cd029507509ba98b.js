(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{"1VCC":function(t,e,i){"use strict";i.d(e,"a",(function(){return s}));var a=i("fXoL"),o=i("TEn/");let s=(()=>{class t{constructor(){this.mostrar=!1}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=a.Kb({type:t,selectors:[["app-progress"]],inputs:{mostrar:"mostrar",titulo:"titulo"},decls:4,vars:2,consts:[[1,"centrado",3,"hidden"],[1,"titulo-item-2"],["type","indeterminate",1,"ion-margin-top"]],template:function(t,e){1&t&&(a.Vb(0,"div",0),a.Vb(1,"ion-label",1),a.zc(2),a.Ub(),a.Rb(3,"ion-progress-bar",2),a.Ub()),2&t&&(a.jc("hidden",!e.mostrar),a.Cb(2),a.Ac(e.titulo))},directives:[o.A,o.G],styles:[".centrado[_ngcontent-%COMP%]{text-align:center;width:100%;height:10%;position:absolute;top:45%;padding-left:60px;padding-right:60px}.titulo-item-2[_ngcontent-%COMP%]{font-size:16px;color:rgba(0,0,0,.87)}"]}),t})()},qi4r:function(t,e,i){"use strict";i.r(e),i.d(e,"NuevoLoginPageModule",(function(){return N}));var a=i("ofXK"),o=i("3Pt+"),s=i("TEn/"),r=i("tyNb"),n=i("mrSG"),l=i("wd/R"),c=i("fXoL"),d=i("ymXj"),m=i("w9zE"),p=i("Li8n"),g=i("skLv"),h=i("uHM+"),u=i("uJRU"),b=i("xS7M"),f=i("49Bu"),v=i("1VCC"),C=i("kmnG"),I=i("qFsG"),S=i("bTqV");let A=(()=>{class t{constructor(t,e,i,a,o,s,r,n,l,c,d,m,p,g){this.navCtrl=t,this.utiles=e,this.servicioGeo=i,this.loading=a,this.formBuilder=o,this.activatedRoute=s,this.router=r,this.acceso=n,this.parametrosApp=l,this.fcmService=c,this.appVersion=d,this.platform=m,this.device=p,this.servNotificaciones=g,this.hide=!0,this.patternOnlyLetter="[a-zA-Z\xc0-\xff\xf1\xd1]+(s*[a-zA-Z\xc0-\xff\xf1\xd1]*)*[a-zA-Z\xc0-\xff\xf1\xd1 ]+$",this.expCelular=/^(\+?56)?(\s?)(0?9)(\s?)[9876543]\d{7}$/gm,this.expPassword=/^(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{4,8}$/gm,this.expEmail=/^[^@\s]+@[^@\s]+\.[^@\s]+$/gm,this.usaEnrolamiento=!1,this.objetoEntrada={VersionAppName:"",Plataforma:"",Token:"",VersionAppNumber:"",Fecha:new Date,TipoOperacion:"0",Id:"0"},this.estaCargando=!1}ngOnInit(){l.locale("es"),this.servNotificaciones.buscarCitasTodas(),this.usaEnrolamiento=this.parametrosApp.USA_LOGIN_ENROLAMIENTO(),this.cargarForma()}abrirAsistente(){this.navCtrl.navigateRoot(["pre-registro-uno"],{queryParams:{modulo:"nuevo-login"}})}cargarForma(){this.forma=new o.e({run:new o.c("",[o.q.required]),email:new o.c("",[o.q.required,o.q.pattern(this.expEmail)]),clave:new o.c("",[o.q.required,o.q.minLength(3),o.q.maxLength(10)])}),this.usaEnrolamiento?this.forma.get("email").clearValidators():this.forma.get("run").clearValidators()}crearToken(){return Object(n.b)(this,void 0,void 0,(function*(){var t,e,i;this.estaCargando=!0;let a=yield this.loading.create({cssClass:"loading-vacio",showBackdrop:!1,spinner:null});yield a.present().then(()=>Object(n.b)(this,void 0,void 0,(function*(){this.utiles.isAppOnDevice()?(this.platform.is("ios")?(t=yield this.appVersion.getAppName(),e=yield this.appVersion.getVersionNumber(),i="iOS"):this.platform.is("android")?(t=yield this.appVersion.getAppName(),e=yield this.appVersion.getVersionNumber(),i="Android"):this.platform.is("mobileweb")?(t="Mi salud familiar",e="0.0",i="Web"):(t="Mi salud familiar",e="0.0",i="No informado"),this.tokenDispositivo=this.device.uuid,localStorage.setItem("token_dispositivo",this.tokenDispositivo),localStorage.setItem("version_app_name",t),localStorage.setItem("version_number",e),localStorage.setItem("plataforma",i),a.dismiss(),this.estaCargando=!1):(localStorage.getItem("token_dispositivo")?this.tokenDispositivo=localStorage.getItem("token_dispositivo"):(this.tokenDispositivo=(999999*Math.random()+1).toString()+" web",localStorage.setItem("token_dispositivo",this.tokenDispositivo)),t="Mi salud familiar",e="0.0",i="Web",localStorage.setItem("version_app_name",t),localStorage.setItem("version_number",e),localStorage.setItem("plataforma",i),a.dismiss(),this.estaCargando=!1)})))}))}registrarEntrada(){return Object(n.b)(this,void 0,void 0,(function*(){if(!sessionStorage.getItem("RSS_ID")){this.objetoEntrada.VersionAppName=localStorage.getItem("version_app_name"),this.objetoEntrada.Plataforma=localStorage.getItem("plataforma"),this.objetoEntrada.VersionAppNumber=localStorage.getItem("version_number"),this.objetoEntrada.Token=localStorage.getItem("token_dispositivo"),this.objetoEntrada.Fecha=new Date,sessionStorage.setItem("ENTRADA",JSON.stringify(this.objetoEntrada)),this.estaCargando=!0;let t=yield this.loading.create({cssClass:"loading-vacio",showBackdrop:!1,spinner:null});yield t.present().then(()=>Object(n.b)(this,void 0,void 0,(function*(){this.utiles.isAppOnDevice()?this.servicioGeo.postIngresoNative(this.objetoEntrada).then(e=>{let i=JSON.parse(e.data);sessionStorage.setItem("RSS_ID",i.Id),t.dismiss(),this.estaCargando=!1}):this.servicioGeo.postIngreso(this.objetoEntrada).subscribe(e=>{e&&e.Id>0&&sessionStorage.setItem("RSS_ID",e.Id),t.dismiss(),this.estaCargando=!1})})))}}))}loguearseRegistro(){return Object(n.b)(this,void 0,void 0,(function*(){let t=this.forma.controls.email.value,e=this.forma.controls.clave?this.utiles.encriptar(this.forma.controls.clave.value):"";this.estaCargando=!0;let i=yield this.loading.create({cssClass:"loading-vacio",showBackdrop:!1,spinner:null});yield i.present().then(()=>Object(n.b)(this,void 0,void 0,(function*(){this.utiles.isAppOnDevice()?this.servicioGeo.getRegistroAppNativeCorreoPassword(t,e).then(t=>{let a=JSON.parse(t.data);if(!a)return this.utiles.presentToast("No se encontr\xf3 registro de usuario.","middle",3e3),this.estaCargando=!1,void i.dismiss();{localStorage.setItem("REGISTRO",JSON.stringify(a)),localStorage.setItem("TIENE_REGISTRO","true"),i.dismiss();let t=JSON.parse(localStorage.getItem("REGISTRO"));this.autentificarse(t.Run,e)}}).catch(t=>{console.log(t.message),this.utiles.presentToast("Error de conexi\xf3n.","middle",3e3),this.estaCargando=!1,i.dismiss()}):this.servicioGeo.getRegistroAppCorreoPassword(t,e).subscribe(t=>{if(!t)return this.utiles.presentToast("No se encontr\xf3 registro de usuario.","middle",3e3),this.estaCargando=!1,void i.dismiss();{localStorage.setItem("REGISTRO",JSON.stringify(t)),localStorage.setItem("TIENE_REGISTRO","true"),i.dismiss();let a=JSON.parse(localStorage.getItem("REGISTRO"));this.autentificarse(a.Run,e)}},t=>{console.log(t.message),this.utiles.presentToast("Error de conexi\xf3n.","middle",3e3),this.estaCargando=!1,i.dismiss()})})))}))}loguearseEnrolamiento(){return Object(n.b)(this,void 0,void 0,(function*(){this.estaCargando=!0;let t=this.forma.controls.run.value,e=this.forma.controls.clave?this.utiles.encriptar(this.forma.controls.clave.value):"";localStorage.setItem("TIENE_REGISTRO","false"),this.autentificarse(t,e)}))}onSubmit(){return Object(n.b)(this,void 0,void 0,(function*(){this.forma.invalid||(this.usaEnrolamiento?this.loguearseEnrolamiento():this.loguearseRegistro())}))}autentificarse(t,e){return Object(n.b)(this,void 0,void 0,(function*(){let i={UserName:t,Password:e,UsaEnrolamiento:this.usaEnrolamiento,TokenFCM:this.utiles.entregaTokenFCM()};this.estaCargando=!0;let a=yield this.loading.create({cssClass:"loading-vacio",showBackdrop:!1,spinner:null});yield a.present().then(()=>Object(n.b)(this,void 0,void 0,(function*(){this.utiles.isAppOnDevice()?this.acceso.loginWebNative(i).then(t=>{this.procesarLogin(JSON.parse(t.data),a)},t=>{this.utiles.presentToast("Ocurri\xf3 un error de autentificaci\xf3n","bottom",4e3),this.estaCargando=!1,a.dismiss()}):this.acceso.loginWebDirecto(i).subscribe(t=>{this.procesarLogin(t,a)},t=>{a.dismiss(),this.estaCargando=!1})})))}))}setDatosUsuario(t,e,i){if(sessionStorage.setItem("UsuarioAps",e),localStorage.setItem("MI_RUT",t.UsuarioAps.Rut),localStorage.setItem("MI_NOMBRE",t.UsuarioAps.Nombres+" "+t.UsuarioAps.ApellidoPaterno),localStorage.setItem("MI_COLOR",t.UsuarioAps.Color),localStorage.setItem("MI_IMAGEN",t.UsuarioAps.UrlImagen),localStorage.setItem("UsuarioAps",e),t.UsuariosFamilia){let e={};var a=t.UsuariosFamilia.filter(t=>!e[t.Id]&&(e[t.Id]=!0));t.UsuariosFamilia=a,i=JSON.stringify(t.UsuariosFamilia),localStorage.setItem("UsuariosFamilia",i)}t.FamiliaPorAceptar&&t.FamiliaPorAceptar.length>=0&&localStorage.setItem("FAMILIA-POR-ACEPTAR",JSON.stringify(t.FamiliaPorAceptar)),t.FamiliaAceptada&&t.FamiliaAceptada.length>=0&&localStorage.setItem("FAMILIA-ACEPTADA",JSON.stringify(t.FamiliaAceptada)),t.FamiliaRechazada&&t.FamiliaRechazada.length>=0&&localStorage.setItem("FAMILIA-RECHAZADA",JSON.stringify(t.FamiliaRechazada)),this.CodigoMensaje=t.RespuestaBase.CodigoMensaje,this.Mensaje=t.RespuestaBase.Mensaje,this.loggedIn=!0}procesarLogin(t,e){var i=t;let a=!1;if(!i.RespuestaBase)return this.loggedIn=!1,this.CodigoMensaje=1e3,this.Mensaje="Error de llamada Http;",this.loggedIn=!0,this.estaCargando=!1,e.dismiss(),void this.utiles.presentToast(this.Mensaje,"middle",4e3);if(0!=i.RespuestaBase.CodigoMensaje)return this.loggedIn=!1,this.CodigoMensaje=i.RespuestaBase.CodigoMensaje,this.Mensaje=i.RespuestaBase.Mensaje,this.loggedIn=!0,e.dismiss(),this.estaCargando=!1,void this.utiles.presentToast(this.Mensaje,"middle",4e3);var o;if(i.UsuarioAps)if((o=JSON.stringify(i.UsuarioAps)).NodId&&this.parametrosApp.USA_ENTIDAD_CONTRATANTE()){if(!(i.UsuarioAps.EntidadContratante&&i.UsuarioAps.EntidadContratante.length>0))return this.utiles.presentToast("No tiene entidad contratante asociada","middle",3e3),e.dismiss(),void(this.estaCargando=!1);a=!0,this.setDatosUsuario(i,o,void 0),e.dismiss(),this.estaCargando=!1}else a=!0,this.setDatosUsuario(i,o,void 0),e.dismiss(),this.estaCargando=!1;a||this.utiles.presentToast("Tiene registro correcto, pero no cuenta con informaci\xf3n en la red de salud.","middle",3e3),this.crearToken(),this.registrarEntrada(),this.irAHome()}irAHome(){this.navCtrl.navigateRoot("home")}irRecuperarClave(){this.navCtrl.navigateRoot("recuperar-clave")}get f(){return this.forma.controls}}return t.\u0275fac=function(e){return new(e||t)(c.Qb(s.Z),c.Qb(d.a),c.Qb(m.a),c.Qb(s.W),c.Qb(o.b),c.Qb(r.a),c.Qb(r.g),c.Qb(p.a),c.Qb(g.a),c.Qb(h.a),c.Qb(u.a),c.Qb(s.bb),c.Qb(b.a),c.Qb(f.a))},t.\u0275cmp=c.Kb({type:t,selectors:[["app-nuevo-login"]],decls:37,vars:12,consts:[[1,"ion-padding"],["titulo","Estamos ingresando a la app",3,"mostrar"],[1,"row","mt-24",3,"hidden"],["src","../../assets/imgs_svg/login.svg","alt","asistente"],["novalidate","",3,"hidden","formGroup"],[1,"ion-no-margin","ion-no-padding","mt-80"],["appearance","outline",2,"width","100%",3,"hidden"],["matInput","","placeholder","125458524","formControlName","run","name","run"],[3,"hidden"],["matInput","","placeholder","ejemplo@gmail.com","formControlName","email","name","email"],["appearance","outline",2,"width","100%"],["matInput","","placeholder","Clave","type","password","name","clave","formControlName","clave","required",""],[1,"ion-no-padding","ion-no-margin","mt-40"],["mat-raised-button","","color","primary",1,"boton-Principal",2,"width","90%","margin-left","5%","height","36px",3,"click"],[1,"mt-36",3,"hidden"],["mat-button","","routerLink",".","color","primary",1,"ion-text-center","accent-color",2,"width","100%",3,"click"],[1,"ion-no-padding","mt-36",3,"hidden"],[1,"ion-text-center","texto-1",2,"margin-top","8px"],["mat-button","","color","primary",1,"accent-color",3,"click"]],template:function(t,e){1&t&&(c.Vb(0,"ion-content",0),c.Rb(1,"app-progress",1),c.Vb(2,"div",2),c.Rb(3,"img",3),c.Ub(),c.Vb(4,"form",4),c.Vb(5,"ion-row",5),c.Vb(6,"mat-form-field",6),c.Vb(7,"mat-label"),c.zc(8,"RUN"),c.Ub(),c.Rb(9,"input",7),c.Vb(10,"mat-error",8),c.zc(11,"Run requerido"),c.Ub(),c.Ub(),c.Vb(12,"mat-form-field",6),c.Vb(13,"mat-label"),c.zc(14,"Correo electr\xf3nico"),c.Ub(),c.Rb(15,"input",9),c.Vb(16,"mat-error",8),c.zc(17,"Correo inv\xe1lido"),c.Ub(),c.Ub(),c.Vb(18,"mat-form-field",10),c.Vb(19,"mat-label"),c.zc(20,"Contrase\xf1a"),c.Ub(),c.Rb(21,"input",11),c.Vb(22,"mat-error",8),c.zc(23,"Clave requerida"),c.Ub(),c.Ub(),c.Ub(),c.Vb(24,"ion-row",12),c.Vb(25,"button",13),c.dc("click",(function(){return e.onSubmit()})),c.zc(26,"INICIAR SESION"),c.Ub(),c.Ub(),c.Ub(),c.Vb(27,"ion-row",14),c.Vb(28,"a",15),c.dc("click",(function(){return e.irRecuperarClave()})),c.zc(29,"\xbfOlvidaste tu contrase\xf1a?"),c.Ub(),c.Ub(),c.Vb(30,"ion-grid",16),c.Vb(31,"ion-row"),c.Vb(32,"ion-col",17),c.zc(33," \xbfNo tienes cuenta? "),c.Ub(),c.Vb(34,"ion-col"),c.Vb(35,"button",18),c.dc("click",(function(){return e.abrirAsistente()})),c.zc(36,"REGISTRATE"),c.Ub(),c.Ub(),c.Ub(),c.Ub(),c.Ub()),2&t&&(c.Cb(1),c.jc("mostrar",e.estaCargando),c.Cb(1),c.jc("hidden",e.estaCargando),c.Cb(2),c.jc("hidden",e.estaCargando)("formGroup",e.forma),c.Cb(2),c.jc("hidden",0==e.usaEnrolamiento),c.Cb(4),c.jc("hidden",0==e.usaEnrolamiento),c.Cb(2),c.jc("hidden",e.usaEnrolamiento),c.Cb(4),c.jc("hidden",e.usaEnrolamiento),c.Cb(6),c.jc("hidden",!(e.f.clave.errors&&e.f.clave.errors.required)),c.Cb(5),c.jc("hidden",e.estaCargando)("hidden",e.usaEnrolamiento),c.Cb(3),c.jc("hidden",e.estaCargando))},directives:[s.p,v.a,o.r,o.l,o.f,s.K,C.c,C.g,I.b,o.a,o.k,o.d,C.b,o.p,S.b,S.a,r.i,s.db,s.t,s.o],styles:[".mt-32[_ngcontent-%COMP%]{margin-top:32px}.mt-24[_ngcontent-%COMP%]{margin-top:24px}.mt-80[_ngcontent-%COMP%]{margin-top:5em}.mt-40[_ngcontent-%COMP%]{margin-top:2.5em}.mt-36[_ngcontent-%COMP%]{margin-top:2.25em}.texto-1[_ngcontent-%COMP%]{font-size:.875em;color:rgba(0,0,0,.54)}.example-container[_ngcontent-%COMP%]   .mat-form-field[_ngcontent-%COMP%] + .mat-form-field[_ngcontent-%COMP%]{margin-left:8px}.example-right-align[_ngcontent-%COMP%]{text-align:right}input.example-right-align[_ngcontent-%COMP%]::-webkit-inner-spin-button, input.example-right-align[_ngcontent-%COMP%]::-webkit-outer-spin-button{display:none}input.example-right-align[_ngcontent-%COMP%]{-moz-appearance:textfield}.accent-color[_ngcontent-%COMP%]{color:#ff4081}.boton-Principal[_ngcontent-%COMP%]{background-color:#ff4081;color:#fff}"]}),t})();var O=i("d3UM"),E=i("NFeN"),R=i("j1ZV");let N=(()=>{class t{}return t.\u0275mod=c.Ob({type:t}),t.\u0275inj=c.Nb({factory:function(e){return new(e||t)},imports:[[a.c,o.g,o.o,s.U,C.e,O.b,I.c,S.c,E.b,R.a,r.j.forChild([{path:"",component:A}])]]}),t})()}}]);