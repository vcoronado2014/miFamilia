function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{"1VCC":function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var a=i("fXoL"),s=i("TEn/"),o=function(){var e=function(){function e(){_classCallCheck(this,e),this.mostrar=!1}return _createClass(e,[{key:"ngOnInit",value:function(){}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=a.Kb({type:e,selectors:[["app-progress"]],inputs:{mostrar:"mostrar",titulo:"titulo"},decls:4,vars:2,consts:[[1,"centrado",3,"hidden"],[1,"titulo-item-2"],["type","indeterminate",1,"ion-margin-top"]],template:function(e,t){1&e&&(a.Vb(0,"div",0),a.Vb(1,"ion-label",1),a.zc(2),a.Ub(),a.Rb(3,"ion-progress-bar",2),a.Ub()),2&e&&(a.jc("hidden",!t.mostrar),a.Cb(2),a.Ac(t.titulo))},directives:[s.A,s.G],styles:[".centrado[_ngcontent-%COMP%]{text-align:center;width:100%;height:10%;position:absolute;top:45%;padding-left:60px;padding-right:60px}.titulo-item-2[_ngcontent-%COMP%]{font-size:16px;color:rgba(0,0,0,.87)}"]}),e}()},zTqs:function(e,t,i){"use strict";i.r(t),i.d(t,"AsociarFamiliaPageModule",(function(){return P}));var a=i("ofXK"),s=i("3Pt+"),o=i("TEn/"),r=i("tyNb"),n=i("mrSG"),c=i("fXoL"),l=i("ymXj"),u=i("w9zE"),d=i("Li8n"),m=i("skLv"),g=i("1VCC"),h=i("bTqV");function p(e,t){if(1&e){var i=c.Wb();c.Vb(0,"div"),c.Vb(1,"ion-item",13),c.Vb(2,"ion-grid"),c.Vb(3,"ion-row"),c.Vb(4,"ion-col",14),c.Vb(5,"h3",15),c.zc(6),c.Ub(),c.Vb(7,"small"),c.zc(8),c.Ub(),c.Ub(),c.Vb(9,"ion-col",16),c.Vb(10,"ion-toggle",17),c.dc("ngModelChange",(function(e){return c.rc(i),t.$implicit.EsAceptado=e})),c.Ub(),c.Ub(),c.Ub(),c.Ub(),c.Ub(),c.Ub()}if(2&e){var a=t.$implicit;c.Cb(6),c.Ac(a.NombreCompleto),c.Cb(2),c.Bc("Run: ",a.Run,""),c.Cb(2),c.jc("checked",a.EsAceptado)("ngModel",a.EsAceptado)}}function f(e,t){if(1&e){var i=c.Wb();c.Vb(0,"div",10),c.yc(1,p,11,4,"div",11),c.Vb(2,"ion-row"),c.Vb(3,"button",12),c.dc("click",(function(){return c.rc(i),c.gc().onSubmit()})),c.zc(4,"GUARDAR"),c.Ub(),c.Ub(),c.Ub()}if(2&e){var a=c.gc();c.Cb(1),c.jc("ngForOf",a.familiaAsociar),c.Cb(2),c.jc("disabled",0==a.familiaAsociar.length)}}var b,A,v=((b=function(){function e(t,i,a,s,o,r,n,c,l,u,d,m,g){_classCallCheck(this,e),this.navCtrl=t,this.toast=i,this.modalCtrl=a,this.platform=s,this.menu=o,this.activatedRoute=r,this.router=n,this.utiles=c,this.loading=l,this.servicioGeo=u,this.acceso=d,this.parametrosApp=m,this.alertController=g,this.familiaAsociar=[],this.estaCargando=!1,this.tituloProgress="",this.nombreUsuario="",this.password="",this.usaEnrolamiento=!1}return _createClass(e,[{key:"ngOnInit",value:function(){if(this.usaEnrolamiento=this.parametrosApp.USA_LOGIN_ENROLAMIENTO(),localStorage.getItem("REGISTRO")){var e=JSON.parse(localStorage.getItem("REGISTRO"));this.usaEnrolamiento&&localStorage.setItem("TIENE_REGISTRO","false"),this.nombreUsuario=e.Run,this.password=e.Password}this.buscar()}},{key:"buscar",value:function(){if(localStorage.getItem("FAMILIA-POR-ACEPTAR")){var e=JSON.parse(localStorage.getItem("FAMILIA-POR-ACEPTAR"));if(e.length>0){for(var t=0;t<e.length;t++)e[t].Run=this.utiles.insertarGuion(e[t].Run),e[t].EsAceptado=1==e[t].Aceptado;this.familiaAsociar=e}}}},{key:"procesarFamilia",value:function(){return Object(n.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,i,a,s,o,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.familiaAsociar&&this.familiaAsociar.length>0)){e.next=9;break}for(t=this.familiaAsociar[0].UspIdTitular.toString(),i=[],a=0;a<this.familiaAsociar.length;a++)(s=this.familiaAsociar[a]).EsAceptado&&i.push(s.UspId.toString());return i&&0==i.length&&i.push("0"),this.estaCargando=!0,this.tituloProgress="Guardando informaci\xf3n de la familia",e.next=6,this.loading.create({cssClass:"loading-vacio",showBackdrop:!1,spinner:null});case 6:return o=e.sent,e.next=9,o.present().then((function(){return Object(n.b)(r,void 0,void 0,regeneratorRuntime.mark((function e(){var a=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.utiles.isAppOnDevice()?this.servicioGeo.actualizaFamiliaNative(i.toString(),t).then((function(e){JSON.parse(e.data)?(o.dismiss(),a.estaCargando=!1,a.tituloProgress="",a.autentificarse()):(o.dismiss(),a.estaCargando=!1,a.tituloProgress="",a.utiles.presentToast("Ocurri\xf3 un error al asociar familia","bottom",3e3))})).catch((function(e){console.log(e.message),o.dismiss(),a.estaCargando=!1,a.tituloProgress="",a.utiles.presentToast("Ocurri\xf3 un error al asociar familia","bottom",3e3)})):this.servicioGeo.actualizaFamilia(i.toString(),t).subscribe((function(e){e?(o.dismiss(),a.estaCargando=!1,a.tituloProgress="",a.autentificarse()):(o.dismiss(),a.estaCargando=!1,a.tituloProgress="",a.utiles.presentToast("Ocurri\xf3 un error al asociar familia","bottom",3e3))}),(function(e){console.log(e.message),o.dismiss(),a.estaCargando=!1,a.tituloProgress="",a.utiles.presentToast("Ocurri\xf3 un error al asociar familia","bottom",3e3)}));case 1:case"end":return e.stop()}}),e,this)})))}));case 9:case"end":return e.stop()}}),e,this)})))}},{key:"onSubmit",value:function(){if(this.familiaAsociar&&this.familiaAsociar.length>0){var e=this.familiaAsociar.length;this.familiaAsociar.filter((function(e){return 1==e.EsAceptado})).length<e?this.presentAlertConfirm("Aviso","Hay al menos un miembro de la familia al cual no est\xe1 aceptando. Posteriormente lo puede volver a aceptar en Activar/Desactivar integrantes. \n\xbfEst\xe1 seguro de continuar?."):this.procesarFamilia()}else this.utiles.presentToast("No hay miembros de la familia a asociar","bottom",3e3)}},{key:"presentAlertConfirm",value:function(e,t){return Object(n.b)(this,void 0,void 0,regeneratorRuntime.mark((function i(){var a,s=this;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,this.alertController.create({header:e,message:t,buttons:[{text:"No",role:"cancel",cssClass:"danger",handler:function(e){console.log("Confirm Cancel: blah")}},{text:"Si",cssClass:"success",handler:function(){s.procesarFamilia()}}]});case 2:return a=i.sent,i.next=5,a.present();case 5:case"end":return i.stop()}}),i,this)})))}},{key:"autentificarse",value:function(){return Object(n.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,i,a=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={UserName:this.nombreUsuario,Password:this.password,UsaEnrolamiento:this.usaEnrolamiento,TokenFCM:this.utiles.entregaTokenFCM()},this.estaCargando=!0,this.tituloProgress="Volviendo a autentificar, espere un momento",e.next=4,this.loading.create({cssClass:"loading-vacio",showBackdrop:!1,spinner:null});case 4:return i=e.sent,e.next=7,i.present().then((function(){return Object(n.b)(a,void 0,void 0,regeneratorRuntime.mark((function e(){var a=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.utiles.isAppOnDevice()?this.acceso.loginWebNative(t).then((function(e){a.procesarLogin(JSON.parse(e.data),i)}),(function(e){console.log(e.message),a.utiles.presentToast("Ocurri\xf3 un error de autentificaci\xf3n","bottom",4e3),a.estaCargando=!1,i.dismiss(),a.tituloProgress=""})):this.acceso.loginWebDirecto(t).subscribe((function(e){a.procesarLogin(e,i)}),(function(e){console.log(e.message),i.dismiss(),a.estaCargando=!1,a.tituloProgress=""}));case 1:case"end":return e.stop()}}),e,this)})))}));case 7:case"end":return e.stop()}}),e,this)})))}},{key:"procesarLogin",value:function(e,t){var i,a=e,s=!1;if(!a.RespuestaBase)return this.loggedIn=!1,this.CodigoMensaje=1e3,this.Mensaje="Error de llamada Http;",this.loggedIn=!0,this.estaCargando=!1,t.dismiss(),void this.utiles.presentToast(this.Mensaje,"middle",4e3);if(0!=a.RespuestaBase.CodigoMensaje)return this.CodigoMensaje=a.RespuestaBase.CodigoMensaje,this.Mensaje=a.RespuestaBase.Mensaje,t.dismiss(),this.estaCargando=!1,void this.utiles.presentToast(this.Mensaje,"middle",4e3);if(a.UsuarioAps)if((i=JSON.stringify(a.UsuarioAps)).NodId&&this.parametrosApp.USA_ENTIDAD_CONTRATANTE()){if(!(a.UsuarioAps.EntidadContratante&&a.UsuarioAps.EntidadContratante.length>0))return this.utiles.presentToast("No tiene entidad contratante asociada","middle",3e3),t.dismiss(),this.estaCargando=!1,void(this.tituloProgress="");s=!0,this.setDatosUsuario(a,i,void 0),t.dismiss(),this.estaCargando=!1,this.tituloProgress=""}else s=!0,this.setDatosUsuario(a,i,void 0),t.dismiss(),this.estaCargando=!1,this.tituloProgress="";s||this.utiles.presentToast("Tiene registro correcto, pero no cuenta con informaci\xf3n en la red de salud.","middle",3e3),this.irAHome()}},{key:"setDatosUsuario",value:function(e,t,i){if(sessionStorage.setItem("UsuarioAps",t),localStorage.setItem("MI_RUT",e.UsuarioAps.Rut),localStorage.setItem("MI_NOMBRE",e.UsuarioAps.Nombres+" "+e.UsuarioAps.ApellidoPaterno),localStorage.setItem("MI_COLOR",e.UsuarioAps.Color),localStorage.setItem("MI_IMAGEN",e.UsuarioAps.UrlImagen),localStorage.setItem("UsuarioAps",t),e.UsuariosFamilia){var a={},s=e.UsuariosFamilia.filter((function(e){return!a[e.Id]&&(a[e.Id]=!0)}));e.UsuariosFamilia=s,i=JSON.stringify(e.UsuariosFamilia),localStorage.setItem("UsuariosFamilia",i)}e.FamiliaPorAceptar&&e.FamiliaPorAceptar.length>=0&&localStorage.setItem("FAMILIA-POR-ACEPTAR",JSON.stringify(e.FamiliaPorAceptar)),e.FamiliaAceptada&&e.FamiliaAceptada.length>=0&&localStorage.setItem("FAMILIA-ACEPTADA",JSON.stringify(e.FamiliaAceptada)),e.FamiliaRechazada&&e.FamiliaRechazada.length>=0&&localStorage.setItem("FAMILIA-RECHAZADA",JSON.stringify(e.FamiliaRechazada)),this.CodigoMensaje=e.RespuestaBase.CodigoMensaje,this.Mensaje=e.RespuestaBase.Mensaje,this.loggedIn=!0}},{key:"irAHome",value:function(){this.navCtrl.navigateRoot("home")}}]),e}()).\u0275fac=function(e){return new(e||b)(c.Qb(o.Z),c.Qb(o.gb),c.Qb(o.Y),c.Qb(o.bb),c.Qb(o.X),c.Qb(r.a),c.Qb(r.g),c.Qb(l.a),c.Qb(o.W),c.Qb(u.a),c.Qb(d.a),c.Qb(m.a),c.Qb(o.a))},b.\u0275cmp=c.Kb({type:b,selectors:[["app-asociar-familia"]],decls:14,vars:4,consts:[[1,"back-app"],["color","primary","mode","md"],["slot","start"],["defaultHref","/home",1,"fcw"],[1,"fcw"],[3,"mostrar","titulo"],[3,"hidden"],[1,"ion-padding"],[1,"texto-item"],["style","padding-top: 16px;",4,"ngIf"],[2,"padding-top","16px"],[4,"ngFor","ngForOf"],["mat-raised-button","","color","accent",1,"button-registrarse",3,"disabled","click"],["lines","inset"],["size","10"],[1,"text-avatar"],["size","2"],["mode","ios",3,"checked","ngModel","ngModelChange"]],template:function(e,t){1&e&&(c.Vb(0,"ion-header",0),c.Vb(1,"ion-toolbar",1),c.Vb(2,"ion-buttons",2),c.Rb(3,"ion-back-button",3),c.Ub(),c.Vb(4,"ion-title",4),c.zc(5,"Asociar familia"),c.Ub(),c.Ub(),c.Ub(),c.Vb(6,"ion-content",0),c.Rb(7,"app-progress",5),c.Vb(8,"div",6),c.Vb(9,"div",7),c.Vb(10,"p",8),c.zc(11," Puede asociar a los miembros de la familia propuestos deslizando el check de cada unos de ellos."),c.Rb(12,"br"),c.Ub(),c.Ub(),c.yc(13,f,5,2,"div",9),c.Ub(),c.Ub()),2&e&&(c.Cb(7),c.jc("mostrar",t.estaCargando)("titulo",t.tituloProgress),c.Cb(1),c.jc("hidden",t.estaCargando),c.Cb(5),c.jc("ngIf",t.familiaAsociar.length>0))},directives:[o.u,o.T,o.i,o.e,o.f,o.R,o.p,g.a,a.k,a.j,o.K,h.b,o.z,o.t,o.o,o.S,o.b,s.k,s.n],styles:[".button-registrarse[_ngcontent-%COMP%]{margin-top:32px;width:90%;margin-left:5%}"]}),b),C=i("j1ZV"),U=i("kmnG"),R=i("d3UM"),I=i("qFsG"),O=i("NFeN"),P=((A=function e(){_classCallCheck(this,e)}).\u0275mod=c.Ob({type:A}),A.\u0275inj=c.Nb({factory:function(e){return new(e||A)},imports:[[a.c,s.g,U.e,R.b,I.c,h.c,O.b,o.U,C.a,r.j.forChild([{path:"",component:v}])]]}),A)}}]);